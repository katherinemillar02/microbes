<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Beta Diversity Analysis Methods ‚Äì Microbial Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../hexmedfly.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../hexmedfly.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Microbial Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../qmds/introduction.html"> 
<span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-diversity-metrics-and-ordination-methods" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Diversity Metrics and Ordination Methods</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-diversity-metrics-and-ordination-methods">    
        <li>
    <a class="dropdown-item" href="../qmds/alpha.html">
 <span class="dropdown-text">Alpha Diversity Analysis Methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../qmds/beta.html">
 <span class="dropdown-text">Beta Diversity Analysis Methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../qmds/PCA.html">
 <span class="dropdown-text">Principal Component Analysis (PCA)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../qmds/PCoA.html">
 <span class="dropdown-text">Principal Co-ordinate Analysis (PCoA)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../qmds/NMDS.html">
 <span class="dropdown-text">Non-Metric Multidimensional Scaling (NMDS)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../qmds/microbialsummary.html">
 <span class="dropdown-text">The Microbial Summary</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tephritid-microbiota" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tephritid Microbiota</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tephritid-microbiota">    
        <li>
    <a class="dropdown-item" href="../qmds/tephritidecology.html">
 <span class="dropdown-text">Distribution of Tephritid Pests</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-profiling-the-microbiota" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Profiling the Microbiota</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-profiling-the-microbiota">    
        <li>
    <a class="dropdown-item" href="../qmds/sequencingtechniques.html">
 <span class="dropdown-text">Microbial Sequencing Techniques</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../qmds/dnaextraction.html">
 <span class="dropdown-text">DNA Extraction and Lysis</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-beta-diversity" id="toc-what-is-beta-diversity" class="nav-link active" data-scroll-target="#what-is-beta-diversity">What is Beta Diversity?</a></li>
  <li><a href="#bray-curtis-dissimilarity" id="toc-bray-curtis-dissimilarity" class="nav-link" data-scroll-target="#bray-curtis-dissimilarity">Bray-Curtis Dissimilarity</a></li>
  <li><a href="#jaccard-dissimilarity" id="toc-jaccard-dissimilarity" class="nav-link" data-scroll-target="#jaccard-dissimilarity">Jaccard Dissimilarity</a></li>
  <li><a href="#bray-curtis-vs.-jaccard" id="toc-bray-curtis-vs.-jaccard" class="nav-link" data-scroll-target="#bray-curtis-vs.-jaccard">Bray-Curtis vs.&nbsp;Jaccard</a></li>
  <li><a href="#test-your-understanding" id="toc-test-your-understanding" class="nav-link" data-scroll-target="#test-your-understanding">Test your understanding!</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Beta Diversity Analysis Methods</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Beta Diversity, as discussed is a measure of dissimilarity or similarity between two different communities.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/beta2.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption>This image was generated from ChatGPT.</figcaption>
</figure>
</div>
</div>
</div>
<section id="what-is-beta-diversity" class="level1">
<h1>What is Beta Diversity?</h1>
<p>Beta Diversity, is a measure of dissimilarity or similarity between <strong>two different</strong> communities. Not different bacteria within one community as described by alpha diversity.</p>
<p>There are many methods which can be used to calculate Beta Diversity, in this section, you will be introduced to:</p>
<p><strong>Bray-Curtis Dissimilarity</strong> and <strong>Jaccard Dissimilarity</strong></p>
<p>&nbsp;</p>
</section>
<section id="bray-curtis-dissimilarity" class="level1">
<h1>Bray-Curtis Dissimilarity</h1>
<p>A statistical method founded by J. Roger Bray and John T. Curtis.</p>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="images/braycurtishistory.png" class="img-fluid figure-img" style="width:45.0%"></p>
<figcaption>This image was generated with ChatGPT.</figcaption>
</figure>
</div>
</div>
</div>
<p>Bray-Curtis Dissimilarity can be described as a statistic used to quantify the <strong>dissimilarity</strong> in composition of species (in this context, microbes) between <strong>two</strong> different sites. It works by a formula (explained below) outputting a value between 0 and 1, with 0 meaning the sites are exactly the same, to very similar, and 1 being they are very dissimilar.</p>
<p>&nbsp;</p>
<p>The formula used in <strong>Bray-Curtis Dissimilarity</strong> is shown below:</p>
<p>&nbsp;</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mathsanalysis.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="442"></p>
</figure>
</div>
</div>
</div>
<section id="bray-curtis-dissimilarity-in-action" class="level4">
<h4 class="anchored" data-anchor-id="bray-curtis-dissimilarity-in-action"><strong>Bray-Curtis Dissimilarity in action</strong></h4>
<p>Lets go through an example of how <strong>Bray-Curtis Dissimilarity</strong> works, using data from <a href="https://www.microbiologyresearch.org/content/journal/mgen/10.1099/mgen.0.000801#tab2">Darrington et al.&nbsp;(2022)</a>.</p>
<p>Because Bray-Curtis Dissimilarity is based on a calculation of two different sites, we will use Medfly larval samples taken from two different fruits (Argan üå∞ and Peach üçë, taken from Morocco and Greece respectively). That have been sequenced through 16S rRNA sequencing.</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Sample 1 - Medfly from Morocco (Argan üå∞)</strong></p>
<p><strong>Bacterial composition (relative proportions):</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Bacterium</th>
<th>Proportion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><em>Klebsiella</em></td>
<td>0.75</td>
</tr>
<tr class="even">
<td><em>Pantonea</em></td>
<td>0.15</td>
</tr>
<tr class="odd">
<td><em>Commensalibacter</em></td>
<td>0.10</td>
</tr>
</tbody>
</table>
</div><div class="column" style="width:50%;">
<p><strong>Sample 2 - Medfly from Greece (Peach üçë)</strong></p>
<p><strong>Bacterial composition (relative proportions):</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Bacterium</th>
<th>Proportion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><em>Klebsiella</em></td>
<td>0.25</td>
</tr>
<tr class="even">
<td><em>Pantonea</em></td>
<td>0.50</td>
</tr>
<tr class="odd">
<td><em>Serratia</em></td>
<td>0.05</td>
</tr>
<tr class="even">
<td><em>Spinghobacterium</em></td>
<td>0.15</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>&nbsp;</p>
<p><strong>Calculating Bray-Curtis Dissimilarity (<em>BC<sub>ij</sub></em>)</strong></p>
<p>C<sub>ij</sub> = the sum of <strong>lower</strong> counts found at both sites</p>
<blockquote class="blockquote">
<p>C<sub>ij</sub> = 0.25 + 0.15 = 0.4</p>
</blockquote>
<p>The only bacteria these two samples have in common are <em>Klebsiella</em> and <em>Pantonea</em>, the lowest values of which are 0.25 of <em>Klebsiella</em> (from the peach samples), and 0.15 of <em>Pantonea</em> (from the argan samples).</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Deep Dive into Bray Curtis Dissimilarity">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Deep Dive into Bray Curtis Dissimilarity
</div>
</div>
<div class="callout-body-container callout-body">
<details>
<summary>
Why use the lower counts?
</summary>
<p>In Bray-Curtis dissimilarity, the overlap between two samples is measured by summing the <strong>minimum (lower)</strong> values for each species across the two samples. This captures the <em>shared abundance</em>‚Äîhow much both sites have in common‚Äîwhile ignoring excess that exists only in one site. The lower count for each taxon tells you the maximum that can be considered ‚Äúshared‚Äù between the two samples.</p>
<p>For example, if one site has <em>Klebsiella</em> at 0.75 and the other at 0.25, only <strong>0.25</strong> is considered as the shared amount.</p>
</details>
</div>
</div>
<p>S<sub>i</sub> = total number on site i - Argan</p>
<blockquote class="blockquote">
<p>S<sub>i</sub> = 0.75 + 0.15 + 0.1 = 1</p>
</blockquote>
<p>S<sub>j</sub> = total number on site j - Peach</p>
<blockquote class="blockquote">
<p>S<sub>j</sub> = 0.25 + 0.5 + 0.05 + 0.15 = 1</p>
</blockquote>
<div class="callout callout-style-default callout-tip callout-titled" title="Deep Dive into Bray Curtis Dissimilarity">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Deep Dive into Bray Curtis Dissimilarity
</div>
</div>
<div class="callout-body-container callout-body">
<details>
<summary>
Why do we work out the total counts on each site?
</summary>
<p>By dividing by the total abundance across both sites, we <strong>normalise</strong> the shared abundance, accounting for differences in sample size or total population. This allows the measure to reflect <strong>relative similarity</strong> rather than absolute counts, ensuring the value ranges between 0 (identical) and 1 (completely different).</p>
<p>In other words, calculating totals ensures that the Bray-Curtis dissimilarity is <strong>scale-independent</strong> and fair across samples of different sizes.</p>
</details>
</div>
</div>
<p>Now that we have:</p>
<p><span class="math display">\[
C_{ij} = 0.4 \\
\]</span> <span class="math display">\[
S_i = 1 \\
\]</span> <span class="math display">\[
S_j = 1
\]</span></p>
<p>The Bray-Curtis formula is:</p>
<p><span class="math display">\[
BC_{ij} = 1 - \frac{2 C_{ij}}{S_i + S_j}
\]</span></p>
<p>Plugging in the values:</p>
<p><span class="math display">\[
BC_{ij} = 1 - \frac{2*0.4}{1 + 1}
\]</span></p>
<p>Calculate the division:</p>
<p><span class="math display">\[
\frac{0.8}{2} = 0.4
\]</span></p>
<p>Finally:</p>
<p><span class="math display">\[
BC_{ij} = 1 - 0.4 = \mathbf{0.6}
\]</span></p>
<p><strong>Interpretation:</strong><br>
Using this formula we have worked out the Bray-Curtis Dissimilarity of the two Medfly microbiotas from Argan and Peach to be <strong>0.6</strong>.</p>
<p>Now let‚Äôs go into what this means. Below shows the scale, where Bray-Curtis dissimilarity will range from 0 - 1, with 1 being the largest amount of dissimilarity between the two samples.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/braycurtisscale.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>From the scale, we can conclude that two samples are not similar, not are they massively dissimilar. But they are more dissimilar than similar! You might be able to see this makes somewhat sense by going back to the dataframe. To put it simply, a Bray-Curtis dissimilarity of <strong>0.6</strong> indicates moderate dissimilarity between the two sites.</p>
<p>&nbsp;</p>
</section>
</section>
<section id="jaccard-dissimilarity" class="level1">
<h1>Jaccard Dissimilarity</h1>
<p>Jaccard distance does not take abundances into account; just the presence of microbes in one or both samples.</p>
<p>The Jaccard dissimilarity is defined as:</p>
<p><span class="math display">\[
\text{Jaccard}_{ij} = 1 - \frac{|A \cap B|}{|A \cup B|}
\]</span></p>
<p><strong>A ‚à© B</strong> is the number of <em>shared</em> species (present in both sites).</p>
<p>&nbsp; <strong>A ‚à™ B</strong> is the total number of <em>unique</em> species across both sites.</p>
<p>&nbsp;</p>
<p>Lets take the two samples we used to calculate Bray Curtis Dissimilarity from the <a href="https://www.microbiologyresearch.org/content/journal/mgen/10.1099/mgen.0.000801#tab2">Darrington et al.&nbsp;(2022)</a> data again.</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Sample 1 - Medfly from Morocco (Argan üå∞)</strong></p>
<p><strong>Bacterial composition (relative proportions):</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Bacterium</th>
<th>Proportion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><em>Klebsiella</em></td>
<td>0.75</td>
</tr>
<tr class="even">
<td><em>Pantonea</em></td>
<td>0.15</td>
</tr>
<tr class="odd">
<td><em>Commensalibacter</em></td>
<td>0.10</td>
</tr>
</tbody>
</table>
</div><div class="column" style="width:50%;">
<p><strong>Sample 2 - Medfly from Greece (Peach üçë)</strong></p>
<p><strong>Bacterial composition (relative proportions):</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Bacterium</th>
<th>Proportion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><em>Klebsiella</em></td>
<td>0.25</td>
</tr>
<tr class="even">
<td><em>Pantonea</em></td>
<td>0.50</td>
</tr>
<tr class="odd">
<td><em>Serratia</em></td>
<td>0.05</td>
</tr>
<tr class="even">
<td><em>Spinghobacterium</em></td>
<td>0.15</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>In both the Argan sample, and the Peach sample, there is <em>Klebsiella</em> and <em>Pantonea</em>, this means there are <strong>2</strong> samples which are the same.</p>
<p>In the Argan sample, there is <em>Klebsiella</em>, <em>Pantonea</em> and <em>Commensalibacter</em>. In the Peach sample, there is <em>Klebsiella</em>, <em>Pantonea</em>, <em>Serratia</em> and <em>Spinghobacterium</em>, so there are <strong>5</strong> different bacterias present across both of these samples.</p>
<p>Putting this into a equation is:</p>
<p><span class="math display">\[
\text{Jaccard}_{ij} = 1 - \frac{2}{5}
\]</span></p>
<p><span class="math display">\[
\text{Jaccard}_{ij} = \frac{2}{5} = 0.4
\]</span> <span class="math display">\[
\text{Jaccard}_{ij} = 1 - 0.4 = 0.6
\]</span></p>
<p>Our Jaccard value is <strong>0.6</strong>. Jaccard uses the same dissimilarity scale as Bray Curtis, with 0 being very similar, and 1 being completley dissimilar, so this means, like Bray Curtis, there is <em>moderate</em> dissimilarity.</p>
</section>
<section id="bray-curtis-vs.-jaccard" class="level1">
<h1>Bray-Curtis vs.&nbsp;Jaccard</h1>
<p>An important concept to understand, and something worth testing yourself on, is the difference between the <strong>Bray-Curtis</strong> and <strong>Jaccard</strong> dissimilarity measures.</p>
<ul>
<li><p><strong>Bray-Curtis</strong> considers the <strong>actual abundance</strong> of each bacterial species. It quantifies how different two samples are based on the amount of each bacteria present.</p></li>
<li><p><strong>Jaccard</strong>, by contrast, uses only <strong>presence or absence</strong> data. It ignores the amount of each species are found and focuses solely on whether a species is present in either sample.</p></li>
</ul>
<p>&nbsp;</p>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 30%">
<col style="width: 46%">
</colgroup>
<thead>
<tr class="header">
<th>Metric</th>
<th>Considers Abundance?</th>
<th>Based On</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Bray-Curtis</strong></td>
<td>Yes</td>
<td>The actual count data of the bacteria</td>
</tr>
<tr class="even">
<td><strong>Jaccard</strong></td>
<td>No</td>
<td>Presence/absence of the bacteria</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>In short:</p>
<ul>
<li><strong>Bray-Curtis</strong> ‚Üí <em>The quantity of each bacteria matters</em></li>
<li><strong>Jaccard</strong> ‚Üí <em>Only the presence/absence of each bacteria matters</em></li>
</ul>
</section>
<section id="test-your-understanding" class="level1">
<h1>Test your understanding!</h1>
<hr>
<p><strong>Which of the following best describes the difference between Jaccard and Bray-Curtis dissimilarity?</strong></p>
<div id="quiz1">
<form id="quiz-form-1">
<p><input type="radio" name="q1" value="a"> A. Jaccard uses relative abundance, Bray-Curtis uses only presence/absence<br> <input type="radio" name="q1" value="b"> B. Jaccard uses presence/absence, Bray-Curtis uses abundance<br> <input type="radio" name="q1" value="c"> C. Both use only abundance data<br> <input type="radio" name="q1" value="d"> D. They are mathematically identical<br><br></p>
<button type="button" onclick="checkAnswer1()">
<p>Submit</p>
</button>
</form>
<div id="result1" style="margin-top: 1em; font-weight: bold;">

</div>
</div>
<script>
function checkAnswer1() {
  const answer = document.querySelector('#quiz-form-1 input[name="q1"]:checked');
  const result = document.getElementById("result1");

  if (!answer) {
    result.textContent = "‚ö†Ô∏è Please select an answer.";
    result.style.color = "orange";
    return;
  }

  if (answer.value === "b") {
    result.textContent = "‚úÖ Correct! Jaccard uses presence/absence, Bray-Curtis uses abundance.";
    result.style.color = "green";
  } else {
    result.textContent = "‚ùå Not quite., try again";
    result.style.color = "red";
  }
}
</script>
<hr>
<p><strong>Both Bray-Curtis and Jaccard use a dissimilarity scale of 0‚Äì1. What does this mean?</strong></p>
<div id="quiz2">
<form id="quiz-form-2">
<p><input type="radio" name="q2" value="a"> A. 0 means completely different, 1 means identical<br> <input type="radio" name="q2" value="b"> B. 0 means identical, 1 means completely different<br> <input type="radio" name="q2" value="c"> C. Both always give the same result<br> <input type="radio" name="q2" value="d"> D. The scale measures sample size<br><br></p>
<button type="button" onclick="checkAnswer2()">
<p>Submit</p>
</button>
</form>
<div id="result2" style="margin-top: 1em; font-weight: bold;">

</div>
</div>
<script>
function checkAnswer2() {
  const answer = document.querySelector('#quiz-form-2 input[name="q2"]:checked');
  const result = document.getElementById("result2");

  if (!answer) {
    result.textContent = "‚ö†Ô∏è Please select an answer.";
    result.style.color = "orange";
    return;
  }

  if (answer.value === "b") {
    result.textContent = "‚úÖ Correct! A value of 0 means identical, and 1 means completely different.";
    result.style.color = "green";
  } else {
    result.textContent = "‚ùå Not quite., try again";
    result.style.color = "red";
  }
}
</script>
<hr>
<p><strong>In both Bray-Curtis and Jaccard dissimilarity, the formula starts with ‚Äú1 -‚Äù. Why is that?</strong></p>
<div id="quiz3">
<form id="quiz-form-3">
<p><input type="radio" name="q3" value="a"> A. To invert similarity into dissimilarity<br> <input type="radio" name="q3" value="b"> B. Because the equation calculates diversity directly<br> <input type="radio" name="q3" value="c"> C. To normalize the values between 0 and 1<br> <input type="radio" name="q3" value="d"> D. It‚Äôs an arbitrary choice without meaning<br><br></p>
<button type="button" onclick="checkAnswer3()">
Submit
</button>
</form>
<div id="result3" style="margin-top: 1em; font-weight: bold;">

</div>
</div>
<script>
function checkAnswer3() {
  const answer = document.querySelector('#quiz-form-3 input[name="q3"]:checked');
  const result = document.getElementById("result3");

  if (!answer) {
    result.textContent = "‚ö†Ô∏è Please select an answer.";
    result.style.color = "orange";
    return;
  }

  if (answer.value === "a") {
    result.textContent = "‚úÖ Correct! The '1 -' part inverts similarity measures into a dissimilarity scale.";
    result.style.color = "green";
  } else {
    result.textContent = "‚ùå Not quite., Try again";
    result.style.color = "red";
  }
}
</script>
<hr>
<form id="quiz-form-5">
<p>
<strong>Calculate the Bray-Curtis and Jaccard dissimilarity between the following two samples:</strong>
</p>
<div class="columns">
<div class="column" style="width:100%;">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Bacterial Species</th>
<th>Sample from Greece</th>
<th>Sample from Victoria, AU</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><em>Bacillus</em></td>
<td>2</td>
<td>0</td>
</tr>
<tr class="even">
<td><em>Lactobacillus</em></td>
<td>8</td>
<td>2</td>
</tr>
<tr class="odd">
<td><em>Streptococcus</em></td>
<td>0</td>
<td>4</td>
</tr>
<tr class="even">
<td><em>Escherichia</em></td>
<td>2</td>
<td>2</td>
</tr>
<tr class="odd">
<td><em>Clostridium</em></td>
<td>0</td>
<td>6</td>
</tr>
<tr class="even">
<td><em>Pseudomonas</em></td>
<td>2</td>
<td>2</td>
</tr>
</tbody>
</table>
<p><strong>Test data set</strong>: this table compares the presence of selected bacterial genera (%) in the Melon fruit fly, with gut samples from Greece and Victoria, Australia.</p>
</div><div class="column" style="width:100%;">
<p><label for="bc">Bray-Curtis dissimilarity:</label><br> <input type="text" id="bc" name="bc" style="width: 100%; padding: 8px;"><br><br></p>
<p><label for="jac">Jaccard dissimilarity:</label><br> <input type="text" id="jac" name="jac" style="width: 100%; padding: 8px;"><br><br></p>
<button type="button" onclick="checkAnswer5()">
Submit
</button>

<div id="result5" style="margin-top: 1em; font-weight: bold;">

</div>
</div><script>
function checkAnswer5() {
  const bc = parseFloat(document.getElementById("bc").value.trim());
  const jac = parseFloat(document.getElementById("jac").value.trim());
  const result = document.getElementById("result5");

  if (isNaN(bc) || isNaN(jac)) {
    result.textContent = "‚ö†Ô∏è Please enter numeric answers for both dissimilarities.";
    result.style.color = "orange";
    return;
  }

  const isCorrectBC = Math.abs(bc - 0.6) < 0.001;
  const isCorrectJaccard = Math.abs(jac - 0.5) < 0.001;

  if (isCorrectBC && isCorrectJaccard) {
    result.textContent = "‚úÖ Correct! Bray-Curtis is 0.6 and Jaccard is 0.5";
    result.style.color = "green";
  } else {
    result.textContent = "‚ùå Not quite. Try checking your calculations again .";
    result.style.color = "red";
  }
}
</script><section id="references" class="level1">
<h1>References:</h1>
<p><a href="https://journals.asm.org/doi/10.1128/msystems.00363-21">Beta Diversity of the Microbiome, Su, 2011</a>.</p>
</section>
</div></form>
<p>
This is the end of Beta Diversity. You are now ready to start learning about Ordination Methods. Please click the button below to begin learning about Principal Component Analysis, an important ordination method!
</p>
<div style="text-align: right; margin-top: 2em;">
<p><a href="../qmds/PCA.html" class="btn btn-primary" role="button"> Turn to Principal Component Analysis ‚Üí</a></p>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>