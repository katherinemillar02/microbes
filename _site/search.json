[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Microbial Analysis",
    "section": "",
    "text": "I am Katie Millar and am currently a PhD student in Biological Sciences at the University of East Anglia (UEA), UK.\nI am a student in The Chapman Lab, under the supervision of Tracey Chapman and Philip Leftwich.\nMy research focuses on insect-microbe symbioses, using the Mediterranean fruit fly (Ceratitis capitata), a major agricultural pest. I explore the interactions between the Medfly and its associated microbiota. My broader interests are in microbial communities, insect biology. data analysis, and computational modelling."
  },
  {
    "objectID": "index.html#about",
    "href": "index.html#about",
    "title": "Microbial Analysis",
    "section": "",
    "text": "I am Katie Millar and am currently a PhD student in Biological Sciences at the University of East Anglia (UEA), UK.\nI am a student in The Chapman Lab, under the supervision of Tracey Chapman and Philip Leftwich.\nMy research focuses on insect-microbe symbioses, using the Mediterranean fruit fly (Ceratitis capitata), a major agricultural pest. I explore the interactions between the Medfly and its associated microbiota. My broader interests are in microbial communities, insect biology. data analysis, and computational modelling."
  },
  {
    "objectID": "index.html#this-site",
    "href": "index.html#this-site",
    "title": "Microbial Analysis",
    "section": "This site",
    "text": "This site\nThe main purpose of this site is to introduce key concepts and methods in community analysis, with a particular focus on microbial communities. While the techniques presented are applicable to general ecological data, my examples and explanations are geared toward microbial ecology, reflecting my research interests."
  },
  {
    "objectID": "qmds/dnaextraction.html",
    "href": "qmds/dnaextraction.html",
    "title": "DNA Extraction",
    "section": "",
    "text": "Kits\nDNA Yields"
  },
  {
    "objectID": "qmds/introduction.html",
    "href": "qmds/introduction.html",
    "title": "An Introduction to Microbial Analysis",
    "section": "",
    "text": "This image was created on Canva."
  },
  {
    "objectID": "qmds/introduction.html#microbial-analysis-background",
    "href": "qmds/introduction.html#microbial-analysis-background",
    "title": "An Introduction to Microbial Analysis",
    "section": "Microbial Analysis background:",
    "text": "Microbial Analysis background:\nWelcome! This website is designed to help you explore the world of microbial community analysis. Looking into key concepts such as diversity metrics ‚Äî including alpha and beta diversity, and visualisation and ordination techniques like PCA, PCoA and NMDS. Showing how these work using published datasets, helping you apply these methods to look at meaningful patterns in microbial and community data.\n\nWhy do we look at microbial analysis?\nUnderstanding what‚Äôs in a microbiota and how it changes across environments is key to answering many ecological and biological questions.\n¬† Microbial analysis reveals:\n\nWhat microbes are present\nHow communities vary across conditions\nWhat factors shape these communities ¬†\n\n\n\nWhat can I learn on this website?\nThis site introduces essential methods for calculating both Alpha Diversity and Beta Diversity in microbial communities. You‚Äôll explore widely used ecological metrics, including:\nAlpha Diversity:\n\nCHAO1\n\nShannon‚Äôs Index\nSimpson‚Äôs Index\n\nBeta Diversity:\n\nBray-Curtis dissimilarity\nJaccard index\n\nIn addition to learning Alpha and Diversity metrics, you‚Äôll learn how to visualise microbial community differences using multivariate techniques such as:\nVisualisation and Ordination Methods:\n\nPrincipal Component Analysis (PCA)\nPrincipal Co-Ordinate Analysis (PCoA)\nNon-metric Multidimensional Scaling (NMDS)\n\nThese tools will help you identify and interpret variation in microbial composition with confidence."
  },
  {
    "objectID": "qmds/introduction.html#data-used-darrington-et-al.-2022",
    "href": "qmds/introduction.html#data-used-darrington-et-al.-2022",
    "title": "An Introduction to Microbial Analysis",
    "section": "Data Used: Darrington et al.¬†(2022)",
    "text": "Data Used: Darrington et al.¬†(2022)\nThroughout this website, we use data extracted from a study looking at the microbiota compostion of the pest insect, the Medfly:\n‚ÄúCharacterisation of the symbionts in the Mediterranean fruit fly gut‚Äù\nThis study investigated the gut microbiota of the Mediterranean fruit fly (Ceratitis capitata), a significant agricultural pest, to better understand its microbial associations. The researchers compared the gut bacteria of wild and laboratory-raised flies fed on various diets. They found that while diet strongly influences the gut microbiota, a single bacterium Klebsiella michiganensis/oxytoca (‚ÄúMedkleb‚Äù) was consistently dominant and notably resistant to antibiotics.\n\nData Used on This Website\nThroughout this website, we focus on data from the wild-caught samples in the study. Specifically, the researchers examined how different natural fruit larval diets influence the adult gut microbiome of Mediterranean fruit flies.\nNewly emerged adult female flies (0‚Äì3 days old) were collected during the summer of 2014 from a range of fruit hosts: ¬†\n\nMorocco: Argan ¬†\nCrete: Apricots, Oranges, Grapefruits ¬†\nGreece: Peaches, Oranges, Tangerines\n\nThe flies were preserved in ethanol, transported to the UK, and dissected to isolate DNA from their guts. Their microbial communities were then analysed using short-read 16S rRNA gene sequencing.\n  For full data and analysis, visit the GitHub repository     \n\n\nplease click the next page to begin!\n\n\n Turn to Alpha Diversity ‚Üí"
  },
  {
    "objectID": "qmds/sequencingtechniques.html",
    "href": "qmds/sequencingtechniques.html",
    "title": "Sequencing Techniques",
    "section": "",
    "text": "This section will take you through any sequencing techniques."
  },
  {
    "objectID": "qmds/sequencingtechniques.html#amplicon-sequencing",
    "href": "qmds/sequencingtechniques.html#amplicon-sequencing",
    "title": "Sequencing Techniques",
    "section": "Amplicon Sequencing",
    "text": "Amplicon Sequencing\nAmplicon sequencing is a targeted DNA sequencing approach used to identify and compare specific genetic regions across many samples. For bacteria and archaea, this typically focuses on the 16S rRNA gene\nWhat is the 16S rRNA gene?\nThe 16S rRNA (ribosomal RNA) gene encodes the small subunit ribosomal RNA (SSU rRNA), which is a core structural and functional component of the 30S subunit of the prokaryotic ribosome. This RNA plays an essential role in protein synthesis.\nWhat does ‚Äò16S‚Äô mean?\nThe term 16S refers to the sedimentation coefficient of the RNA molecule, the sedimentation coefficient refers to the rate at which a particle sediments in a centrifugal field. It is measured in Svedberg units, rather than its physical size or molecular weight. This means there are 16 Svedberg units.\nWhy is the 16S rRNA gene used in microbiota studies?\nThe 16S rRNA gene is widely used in microbiota studies because it is highly conserved across bacterial and archaeal taxa, meaning its sequence has remained very similar across different species over evolutionary time. This conservation allows for broad amplification of the gene using universal primers, while the presence of variable regions enables taxonomic discrimination between microorganisms.\nWhat primers are used to sequence the 16S rRNA gene?\nThe primer pair used which targets the full-length 16S rRNA gene is 27F and 1492R, sequencing approaches that capture this entire gene are typically referred to as long-read sequencing.\nWhat are hypervariable regions, and conserved regions, and why are they important?\n\n\n\n\n\nThis image was created on Canva.\n\n\n\n\nThe 16S rRNA gene contains nine hypervariable regions (V1‚ÄìV9), which can provide species- or genus-specific signature sequences for bacterial identification. These hypervariable regions range from approximately 30 to 100 base pairs in length, and their degree of conservation varies widely. Sequencing the full-length 16S rRNA gene (approximately 1,500 bp) enables comparison across all hypervariable regions, improving taxonomic resolution.\n\nThe types of amplicon sequencing:\nWithin amplicon sequencing, there are two main types:\n\n\nShort-read sequencing:\n\nProduces high-accuracy reads of relatively short DNA fragments, commonly used for microbial community profiling.\nIt is called short-read sequencing because it only sequences a section of the 16S rRNA gene. In short read sequences only certain hypervariable regions will be selected. There are a range of hypervariable regions used:\nV1 - V3: bp 27‚Äì534 of the 16S gene.\nV3 bp 341‚Äì534 of the 16S gene.\nV3 - V4 bp 341‚Äì806 of the 16S gene.\nV4 bp 515‚Äì806 of the 16S gene.\nThere is only one main sequencing platform used for high-through put sequencing, and this is Illumina.\n\nIllumina:\n\nIllumina uses sequencing-by-synthesis (SBS) chemistry. This includes fluorescently labelled, reversible terminator nucleotides being incorporated one base at a time and imaged after each cycle.\nIlluimina is known for havig high accuracy: Illumina platforms typically achieve ‚â•99.9% per-base accuracy, making them a gold standard for applications where low error rates are critical (e.g.¬†variant calling, microbial community profiling).\nDepending on the instrument used (e.g.¬†MiSeq, NextSeq, NovaSeq), Illumina can generate millions to billions of reads per run, enabling large-scale population studies and deep metagenomic sequencing.\nThe cost per base is very low.\n\n\n\nLong-read sequencing:\n\nProduces longer DNA reads, allowing better resolution of complex genomic regions and full-length 16S rRNA gene sequencing.\nSequencing platforms for high-throughput sequencing: Pacific Biosciences (PacBio) Uses single-molecule real-time (SMRT) sequencing to generate highly accurate long reads (HiFi reads), well suited for full-length 16S rRNA sequencing and genome assembly.\nOxford Nanopore Technologies (ONT) Sequences DNA by measuring changes in electrical current as molecules pass through nanopores; enables ultra-long reads and real-time sequencing, though with higher raw error rates than short-read platforms.\n\n\nHow amplicon sequencing works:\n\nDNA extraction from samples is conducted (e.g.¬†gut, soil, feces, fruit, insect tissue)\n\nSamples such as gut contents, soil, feces, fruit, insect tissue, etc, are first collected. DNA is extracted from these samples using a commercial DNA extraction kit or laboratory protocol. This process breaks open cells and isolates total DNA, which is then purified and stored in a solution (the DNA extract) for downstream analysis.\n\nIn the lab, PCR amplification is used to target a specific gene region using primers that bind conserved sites.\n\nOnce a DNA sample has been extracted, a PCR reaction mix is prepared. This typically includes:\n\nThe extracted DNA as a template\n\nForward and reverse primers (chosen based on short-read or long-read sequencing)\n\nDNA polymerase, nucleotides (dNTPs), buffer, and other necessary solutions\n\nThe PCR reaction is then carried out using standard thermal cycling steps:\n\nInitial denaturation ‚Äì separates the DNA strands\n\nDenaturation ‚Äì repeated in cycles to keep strands separate\n\nAnnealing ‚Äì primers bind to the target regions\n\nExtension ‚Äì DNA polymerase synthesizes new DNA\n\nThese steps are repeated for multiple cycles to amplify the target region.\n\nIndexing/barcoding so many samples can be pooled together.\n\nIndexing (barcoding) is the process of adding a short, unique DNA sequence (an index or barcode) to each sample during library preparation. Because each sample gets a different index, many samples can be pooled together and sequenced in a single run. After sequencing, the reads are demultiplexed‚Äîsorted back to their original samples‚Äîbased on these index sequences.\n\nHigh-throughput sequencing.\n\nDepending on whether short-read or long-read sequencing is used, high-throughput sequencing is used.\n\nBioinformatic analysis to infer taxonomic identity or genetic variation.\n\nA pipeline is used to analyse the data.\n\nWhat does 16S actually mean in the 16S rRNA gene?\n\n\n A. The gene is exactly 16,000 base pairs long\n\n B. 16S refers to the sedimentation coefficient, meaning the rate at which the particle sediments in a centrifugal field\n\n C. It indicates the gene is found in 16 different bacterial species\n\n D. It estimates species turnover between microbial communities\n\n\nSubmit"
  },
  {
    "objectID": "qmds/PCoA.html",
    "href": "qmds/PCoA.html",
    "title": "Principal Co-ordinate Analysis (PCoA)",
    "section": "",
    "text": "Principal Coordinates Analysis (PCoA), also known as classical multidimensional scaling (MDS), although this is sometimes challenged - is another common ordination technique.\n\n\n\n\n\nCredit: This image was created on Canva.\n\n\n\n\n\nWhat is PCoA?\n\nPCoA is used to analyse or visualise relationships between samples, based on their pairwise distances or dissimilarities.\nIt reduces dimensionality, while preserving as much of the original structure as possible.\nUnlike PCA, PCoA can be applied to non-Euclidean distances, such as Bray‚ÄìCurtis or Jaccard. This means it is more flexible, and it does not have to satisfy any rules.\nThe general goal of PCoA is to represent possible non-Eucledian distances with a set of Eucledian co-ordinates.\nLike most ordination methods, PCoA will project the pairwise distance samples into a co-ordinate system, where axes that best preserve the original distances are selected. Closely related samples cluster together, and dissimilar samples will spread further apart.\nThe general principle is that this reflects is that n sample units can be illustrated in only one dimension!\nThis is different to NMDS because, NMDs uses rank order distance.\n\n\n\nHow do we PCoA?\nLet‚Äôs be a bit simple and go through R.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFruit\nKlebsiella\nAcinetobacter\nPantoea\nPseudoxanthomonas\nSerratia\nStenotrophomonas\nDelftia\nBurkholderia\nSphingomonas\nBacillus\nSphingobacterium\nMycoplasma\n\n\n\n\nApricot\n80%\n10%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n\n\nArgan\n75%\n10%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n5%\n\n\nGF\n75%\n10%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n5%\n\n\nOrange\n70%\n15%\n5%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n\n\nPeach\n60%\n10%\n10%\n10%\n5%\n5%\n0%\n0%\n5%\n5%\n0%\n0%\n\n\nTang\n40%\n10%\n20%\n20%\n10%\n5%\n0%\n5%\n10%\n0%\n0%\n0%\n\n\n\n\n¬†\nAs demonstrated briefly above, if we are using R to calculate the Bray-Curtis dissimilarity values, we first want to put our data into a dataframe containing the relative abundance of our bacteria for each of the six fruit samples. As we did earlier we will use \"bray\" in the vegdist() function in R to calculate the Bray-Curtis dissimilarity values. Ensuring we are making a dataframe where row names have been ommited.\n\n\n          Apricot     Argan        GF    Orange     Peach      Tang\nApricot 0.0000000 0.1000000 0.1000000 0.1500000 0.3170732 0.5348837\nArgan   0.1000000 0.0000000 0.0000000 0.0952381 0.2558140 0.4666667\nGF      0.1000000 0.0000000 0.0000000 0.0952381 0.2558140 0.4666667\nOrange  0.1500000 0.0952381 0.0952381 0.0000000 0.2093023 0.4222222\nPeach   0.3170732 0.2558140 0.2558140 0.2093023 0.0000000 0.2608696\nTang    0.5348837 0.4666667 0.4666667 0.4222222 0.2608696 0.0000000\n\n\nIn R we can use cmdscale because PCoA is supposodley the same as classical multidimendional scaling.\n\n\nWarning: Removed 6 rows containing missing values or values outside the scale range\n(`geom_path()`).\n\n\n\n\n\nMakes sense.\n\nGenerate a distance matrix\n\n\nA dissimilarity matrix is created from the original data.\nThe matrix is centralised (to adjust it for eigen-decomposition).\n\nLet‚Äôs use the Darrington dataset and R to work this out.\n\nEigen-decomposition\n\n\nThe centralised matrix undergoes eigen-decomposition.\nLike PCA, The eigenvalues we generate represent the variance explained; eigenvectors define new co-ordinate axes (also like what we learnt in PCA)!\n\n\nSelect pricipal coordinates\n\n\nCoordinates corresponding to the largest eigenvalues are kept, as these are the best representation of the data.\n\n\nProject samples\n\n\n\nEach sample is assigned coordinates in this reduced space, this is the visualisation.\n\n\n\nPCA vs PCoA:\n\nPCoA is a special type of PCA, because it does not need Eucledian distances.\nPCA needs Eucledian distances.\nIn PCoA, distance matrixes can be used.."
  },
  {
    "objectID": "qmds/alpha.html",
    "href": "qmds/alpha.html",
    "title": "Alpha Diversity Analysis Methods",
    "section": "",
    "text": "This image was generated from ChatGPT.\n\n\n\n\n\nWhat is Alpha Diversity?\nAlpha diversity, is diversity within a sample. It how diverse or rich your microbiome sample is in terms of different microorganisms.\nTwo important things are focused on:\n\nSpecies richness: the number of different species present in a sample. Abundance of species, nor their relative distributions are considered.\nSpecies eveness: a measure of relative abundance of different species that make up richness.\n\n\nCommon Alpha Diversity Metrics:\n\nCHAO1 Index: a non-parametric estimator used to estimate species richness (the total number of species actually in a community). Which is especially important when some species are rare and may not be observed.\nShannon Index: a measure of diversity within a community, that considers both species richness and evenness. This is more sensitive to the presence of rare species. A higher Shannon index indicates greater diversity within a community.\nSimpson Index: a measure of diversity within a community, that considers both species richness and evenness. This is more sensitive to the dominance of a few species. A higher Simpson index indicates greater diversity within a community.\n\n¬†\nNow let‚Äôs take some time to go into each of these methods in detail:\n\n\n\nCHAO1 Index\nThe CHAO1 Index is a non-parametric estimator used to measure species richness, focusing on the total number of Operational Taxonomic Units (OTUs), or Amplicon Sequence Variance (ASVs) in a sample. It is particularly useful in microbiota research, where the data are often highly skewed and many species are rare or underrepresented.\nTo put it in simple words, the CHAO1 index is brilliant for identifying rare species. To be specific it accounts for species that only appear once (singletons) or twice (doubletons) in a dataset, showing true total species richness.\nThe CHAO1 Index formula is:\n\\[\n\\text{CHAO1} = S_{\\text{obs}} + \\frac{F_1^2}{2F_2}\n\\] ¬†\n\\[\nS_{\\text{obs}}= \\text{Number of observed species (ASVs or OTUS)}\n\\]\n\\[\nF_{1} = \\text{Number of singleton species (species observed only once)}\n\\]\n\\[\nF_{2} = \\text{Number of doubleton species (species observed only twice)}\n\\] ¬†\n\nCHAO1 Index in action:\nLet‚Äôs use this with some bacteria we found in the Darrington et al. (2022) dataset. This is based on relative proportions of bacteria, but that has been regenerated to generate total counts of bacteria.\n\nMedfly from Morocco (Argan üå∞)Bacterial composition counts, these counts are generated based on relative proportions:\n\n\nBacterium\nCount\n\n\n\n\nKlebsiella\n270\n\n\nPantonea\n54\n\n\nCommensalibacter\n36\n\n\nSpingomonas\n1\n\n\nSerratia\n1\n\n\nAcinetobacter\n2\n\n\nDelftia\n1\n\n\n\n\n¬†\nWe first find our F1 values, these are our singletons - bacteria in our sample that only appear once. In our sample, we only have 3 of these (Spingomonas, Serratia and Delftia). \\[\nF_1 = 3 \\\\\n\\] We then find our F2 values, these are our doubletons - bacteria in our sample that only appear twice In our sample, we only have 1 of these ( Acinetobacter). \\[ ¬†\nF_2 = 1 \\\\\n\\] ¬†\nNow, let‚Äôs plug these into our CHAO1 formula: \\[\n\\begin{align*}\n\\text{CHAO1} &= 5 + \\frac{3^2}{2 \\times 1} \\\\\n             &= 5 + \\frac{9}{2} \\\\\n             &= 5 + 4.5 = 9.5\n\\end{align*}\n\\]\n\\[\n\\text{CHAO1}  = 9.5\n\\] ¬†\n\nWhat does this value mean?\nA CHAO1 index value of 9.5 means the estimated total species richness (or number of OTUs/ASVs) in the sample is about 9.5 species. Although we saw there were 7 different species, our CHAO1 index tells us that there is likely a few more species that were not detected. This estimates reflects the statistical calculation.\nCHAO1 has told us about, rare - possibly underrepresented samples. Keeping on the topic of investigating for rare species, below I introduce to you; the Shannon Diversity Index. Although this metric is a measure of both species richness and eveness, it has a paritcular focus on rareity in samples.\n\n\n\n\nShannon Diversity Index\nThe Shannon Diversity Index accounts for; how many species are present, AND how evenly they are distributed. It summarises the diversity in the population while assuming all species are represented in a sample. Both for species richness and evenness.\nThe Shannon Diveristy formula:\n\\[\nH' = -\\sum_{i=1}^{S} p_i \\log p_i\n\\]\n\\[\n{\\text{H'}}= \\text{Shannon diversity index}\n\\]\n\\[\n{\\text{S}}= \\text{Total number of species}\n\\]\n\\[\np_{\\text{i}}= \\text{Relative proportion of individuals belonging to the species}\n\\]\nLet‚Äôs see this in action using this dataset:\n\nSample 1 - Medfly from Morocco (Argan üå∞)Bacterial composition (actual counts):\n\n\nBacterium\nCount\n\n\n\n\nKlebsiella\n270\n\n\nPantonea\n54\n\n\nCommensalibacter\n36\n\n\nSpingomonas\n1\n\n\nSerratia\n1\n\n\nAcinetobacter\n2\n\n\nDelftia\n1\n\n\n\n\nStep 1: Calculate realtive proportions:\nLet‚Äôs first compute our relative proportions:\nOur total count is: 270 + 54 + 36 + 1 + 1 +2 + 1 = 365.\nSo to find our relative proportions, we divide each of our total counts by 365, this is done below:\nSample 1 - Medfly from Morocco (Argan üå∞)\nBacterial composition (actual counts (Count), and relative proportions (pi)):\n\n\n\nBacterium\nCount\npi\n\n\n\n\nKlebsiella\n270\n270/365 = 0.7397\n\n\nPantonea\n54\n0.1479\n\n\nCommensalibacter\n36\n0.0986\n\n\nSpingomonas\n1\n0.0027\n\n\nSerratia\n1\n0.0027\n\n\nAcinetobacter\n2\n0.0055\n\n\nDelftia\n1\n0.0027\n\n\n\nStep 2: Apply the Shannon diversity formula\nFor each species, we multiply its relative proporition (pi)) by the natural logarithim of that proportion, and then multiply by -1. These values are then summed to give the overall diversity index. This is shown below. You don‚Äôt see - 1 directly so this may be confusing but the below basically translates to the same thing:\n\\[\\begin{aligned}\n&-(0.7397 \\times \\log(0.7397)) = 0.2221 \\\\\n&-(0.1479 \\times \\log(0.1479)) = 0.2812 \\\\\n&-(0.0986 \\times \\log(0.0986)) = 0.2280 \\\\\n&-(0.0027 \\times \\log(0.0027)) = 0.0166 \\\\\n&-(0.0027 \\times \\log(0.0027)) = 0.0166 \\\\\n&-(0.0055 \\times \\log(0.0055)) = 0.0305 \\\\\n&-(0.0027 \\times \\log(0.0027)) = 0.0166 \\\\\n& \\\\\n\\end{aligned}\\]\nWe then finish by adding all of these together:\n\\[\\begin{aligned}\nH' &= 0.2221 + 0.2812 + 0.2280 + 0.0166 + 0.0166 + 0.0305 + 0.0166 \\\\\n   &= \\boxed{0.8116}\n\\end{aligned}\\]\nLet‚Äôs test our R understanding by running it in there.\n\nlibrary(vegan)\nbacteria_counts &lt;- c(\n  Klebsiella = 270,\n  Pantonea = 54,\n  Commensalibacter = 36,\n  Spingomonas = 1,\n  Serratia = 1,\n  Acinetobacter = 2,\n  Delftia = 1\n)\n\nshannon &lt;- diversity(bacteria_counts, index = \"shannon\")\nshannon\n\n[1] 0.8112068\n\n\nThese are not exactly the same, but they are pretty close, and we can use it to confirm that our manual calculations worked.\n\nWhat does this value mean?\nThere is no strict limit of the Shannon Index, but indexs tend to range can from 0 (this would mean very low diversity), upwards of around 3 or 4 (meaning very high diversity). So our value of 0.7 would mean while there are clearly multiple species within our sample, there is uneven distribution and our diversity is not the highest.\nHopefully now that we understand the Shannon Index, we can move onto the final metric we are looking at, this is the Simpson Index. Like the Shannon index, it is a measure of diversity within a community, but rather than focusing on more rare species, it focuses on the more dominant species.\n\n\n\nSimpson‚Äôs Index\nThe Simpson Diversity Index is used to calculate a measure of diversity, which takes into account the number of taxa, as well as abundance. If one type of microorganism dominates the sample - the simpson index will show lower diversity. Only a few rare species will not effect the diversity of a sample.\n\\[\nD = 1 - _{}^{} \\frac{n(n - 1)}{N(N - 1)}\n\\]\n\\[\n{\\text{D}}= \\text{Simpson's Index}\n\\]\n\\[\n{\\text{n}}= \\text{Number of individuals in single species}\n\\]\n\\[\n{\\text{N}}= \\text{Number of individuals in total population}\n\\]\nLet‚Äôs use our count data from earlier!\n\nSample 1: Medfly from Morocco (Argan üå∞)Bacterial composition (relative proportions), these counts are generated based on relative proportions:\n\n\nBacterium\nCount (n)\nn(n-1)\n\n\n\n\nKlebsiella\n270\n72,630\n\n\nPantonea\n54\n2,862\n\n\nCommensalibacter\n36\n1,260\n\n\nSpingomonas\n1\n0\n\n\nSerratia\n1\n0\n\n\nAcinetobacter\n2\n2\n\n\nDelftia\n1\n0\n\n\nTotal\nN = 365\nn(n-1) = 76,752\n\n\n\\[\nD = 1 - \\frac{76752}{365(364)} = \\frac{76752}{132860} = 0.5776908\n\\]\\[\nD = 1 - 0.5776908 = 0.4223092\n\\]\n\nCool, our simpson‚Äôs index is 0.4223092\nNow, I will be showing you how to do this in R. Using the vegan() package introduced earlier.\n\n# Let's first put these counts into a dataframe. \nbacteria_counts &lt;- c(\n  Klebsiella = 270,\n  Pantonea = 54,\n  Commensalibacter = 36,\n  Spingomonas = 1,\n  Serratia = 1,\n  Acinetobacter = 2,\n  Delftia = 1)\n\n# Then, using vegan(), we use diversity(), with the index \"simpson\" \nlibrary(vegan)\nsimpson_index &lt;- diversity(bacteria_counts, index = \"simpson\")\n\nsimpson_index\n\n[1] 0.4211372\n\n\nBoth calculating it ourselves, and using the R function, we get 0.42 - nice one!\n\n\nTest your understanding!\n\nWhat does Shannon Diversity look for?\n\n\n A. Species richness only  B. Species evenness and richness, with a focus on rare species  C. Only species evenness  D. Genetic diversity within species Submit\n\n\n\n\n\n\nWhat does the CHAO1 index look for?\n\n\n A. Species richness, with a particular focus on rare species  B. Measures species evenness  C. Measures genetic diversity within species  D. Estimates species turnover between communities\n\nSubmit\n\n\n\n\n\n\n\nWhat does the Simpson Index look for?\n\n\n A. Measures the proportion of endemic species unique to a geographic area   B. Measures species richness and evenness, with a focus on dominant species   C. Measures genetic diversity within species  D. Measures species richness and evenness, with a focus on rare species \n\nSubmit\n\n\n\n\n\n\n\nBoth Shannon‚Äôs and Simpson‚Äôs indices measure community diversity by considering both species evenness and richness. What is the key difference between them?\n\n\n A. Shannon‚Äôs index is calculated only from the number of species, while Simpson‚Äôs index is calculated only from the abundance of species.   B. Simpson‚Äôs focuses more on dominant species, Shannon‚Äôs focuses more on rare species   C. Simpson‚Äôs focuses more on rare species, Shannon‚Äôs focuses more on dominant species s.  D. Shannon‚Äôs index uses a logarithmic scale, while Simpson‚Äôs index uses an exponential scale \n\nSubmit\n\n\n\n\n\n\n\n\nCongratulations! You have now completed learning about Alpha Diversity, Please click the button below to begin learning about Beta Diversity Analysis methods!\n\n\n Turn to Beta Diversity ‚Üí"
  },
  {
    "objectID": "qmds/microbialsummary.html",
    "href": "qmds/microbialsummary.html",
    "title": "The Microbial Summary",
    "section": "",
    "text": "This image was created on Canva.\nWe have explored Beta Diversity methods, PCA, and NMDS separately, but understanding how they relate (or do not relate) to each other could be an essential step in having a true understanding of all of these.\nThis section will show you how these tools collectively help us interpret complex microbial community differences.\nLet‚Äôs see how well you can integrate these concepts to gain a fuller picture of microbial ecology."
  },
  {
    "objectID": "qmds/microbialsummary.html#alpha-diversity-vs.-beta-diversity---when-to-use-them.",
    "href": "qmds/microbialsummary.html#alpha-diversity-vs.-beta-diversity---when-to-use-them.",
    "title": "The Microbial Summary",
    "section": "Alpha Diversity vs.¬†Beta Diversity - when to use them.",
    "text": "Alpha Diversity vs.¬†Beta Diversity - when to use them."
  },
  {
    "objectID": "qmds/microbialsummary.html#pca-vs.-nmds-what-is-the-difference",
    "href": "qmds/microbialsummary.html#pca-vs.-nmds-what-is-the-difference",
    "title": "The Microbial Summary",
    "section": "PCA vs.¬†NMDS ‚Äì What is the difference?",
    "text": "PCA vs.¬†NMDS ‚Äì What is the difference?\nBoth PCA (Principal Component Analysis) and NMDS (Non-metric Multidimensional Scaling) are methods used to reduce the dimensionality of complex microbial data and visualise patterns ‚Äî but they do so in fundamentally different ways.\n\nPCA is a linear method that assumes your data can be explained by axes that maximize variance. It works best when your distances are normally distributed.\nNMDS, on the other hand, is a non-linear, rank-based method. It doesn‚Äôt use the raw distances, but rather the rank order of dissimilarities.\n\n\nEucledian distances: PCA vs.¬†NMDS.\n\nPCA assumes that the data lies in a linear Euclidean space. It relies on straight-line distances and angles between data points. PCA uses these Euclidean distances implicitly when calculating the covariance matrix, which determines the directions of greatest variance in the dataset.\nNMDS does not assume linearity or metric relationships. Instead, it works with a dissimilarity matrix, which can be based on Euclidean distances or other measures (like Bray-Curtis or Jaccard). Importantly, NMDS only considers the rank order of the distances ‚Äî not their actual values ‚Äî and attempts to preserve these ranks in a lower-dimensional space.."
  },
  {
    "objectID": "qmds/microbialsummary.html#getting-into-the-background-alpha-diversity-vs.-beta-diversity",
    "href": "qmds/microbialsummary.html#getting-into-the-background-alpha-diversity-vs.-beta-diversity",
    "title": "The Microbial Summary",
    "section": "Getting into the background: Alpha Diversity vs.¬†Beta Diversity",
    "text": "Getting into the background: Alpha Diversity vs.¬†Beta Diversity\nNow that you have a brief background on this website, we can start thinking about microbial communities and how they are analysed. A good starting point is to introduce key concepts such as; Alpha and Beta diversity. Gaining an understanding of these measures provides a strong foundation for studying microbial community structure and variation, and serves as a gateway into more advanced community analysis techniques.\n¬† Alpha Diversity describes the diversity within a single sample or environment, while Beta Diversity describes the differences in diversity between two or more samples or environments.\n¬† ¬†\n\n\n\n\n\n\n\nThis image was generated from ChatGPT.\n\n\n\n\n\n\nAlpha Diversity refers to the diversity within a sample. For example, Orange vs.¬†Blue vs.¬†Green vs.¬†Pink.\n\n\n\n\n\n\n\n\n\nThis image was generated from ChatGPT.\n\n\n\n\n\n\nBeta diversity refers to the overall diversity between samples.For example, how the colours on the left collectively compare to the colours on the right.\n\n\nThese may seem easy to remember on the surface, but they can easily be forgotten!"
  },
  {
    "objectID": "qmds/beta.html",
    "href": "qmds/beta.html",
    "title": "Beta Diversity Analysis Methods",
    "section": "",
    "text": "Beta Diversity, as discussed is a measure of dissimilarity or similarity between two different communities.\n\n\n\n\n\nThis image was generated from ChatGPT.\n\n\n\n\n\nWhat is Beta Diversity?\nBeta Diversity, is a measure of dissimilarity or similarity between two different communities. Not different bacteria within one community as described by alpha diversity.\nThere are many methods which can be used to calculate Beta Diversity, in this section, you will be introduced to:\nBray-Curtis Dissimilarity and Jaccard Dissimilarity\n¬†\n\n\nBray-Curtis Dissimilarity\nA statistical method founded by J. Roger Bray and John T. Curtis.\n\n\n\n\n\nThis image was generated with ChatGPT.\n\n\n\n\nBray-Curtis Dissimilarity can be described as a statistic used to quantify the dissimilarity in composition of species (in this context, microbes) between two different sites. It works by a formula (explained below) outputting a value between 0 and 1, with 0 meaning the sites are exactly the same, to very similar, and 1 being they are very dissimilar.\n¬†\nThe formula used in Bray-Curtis Dissimilarity is shown below:\n¬†\n\n\n\n\n\n\n\n\n\n\nBray-Curtis Dissimilarity in action\nLets go through an example of how Bray-Curtis Dissimilarity works, using data from Darrington et al.¬†(2022).\nBecause Bray-Curtis Dissimilarity is based on a calculation of two different sites, we will use Medfly larval samples taken from two different fruits (Argan üå∞ and Peach üçë, taken from Morocco and Greece respectively). That have been sequenced through 16S rRNA sequencing.\n\n\nSample 1 - Medfly from Morocco (Argan üå∞)\nBacterial composition (relative proportions):\n\n\n\nBacterium\nProportion\n\n\n\n\nKlebsiella\n0.75\n\n\nPantonea\n0.15\n\n\nCommensalibacter\n0.10\n\n\n\n\nSample 2 - Medfly from Greece (Peach üçë)\nBacterial composition (relative proportions):\n\n\n\nBacterium\nProportion\n\n\n\n\nKlebsiella\n0.25\n\n\nPantonea\n0.50\n\n\nSerratia\n0.05\n\n\nSpinghobacterium\n0.15\n\n\n\n\n\n¬†\nCalculating Bray-Curtis Dissimilarity (BCij)\nCij = the sum of lower counts found at both sites\n\nCij = 0.25 + 0.15 = 0.4\n\nThe only bacteria these two samples have in common are Klebsiella and Pantonea, the lowest values of which are 0.25 of Klebsiella (from the peach samples), and 0.15 of Pantonea (from the argan samples).\n\n\n\n\n\n\nDeep Dive into Bray Curtis Dissimilarity\n\n\n\n\n\nWhy use the lower counts?\n\nIn Bray-Curtis dissimilarity, the overlap between two samples is measured by summing the minimum (lower) values for each species across the two samples. This captures the shared abundance‚Äîhow much both sites have in common‚Äîwhile ignoring excess that exists only in one site. The lower count for each taxon tells you the maximum that can be considered ‚Äúshared‚Äù between the two samples.\nFor example, if one site has Klebsiella at 0.75 and the other at 0.25, only 0.25 is considered as the shared amount.\n\n\n\nSi = total number on site i - Argan\n\nSi = 0.75 + 0.15 + 0.1 = 1\n\nSj = total number on site j - Peach\n\nSj = 0.25 + 0.5 + 0.05 + 0.15 = 1\n\n\n\n\n\n\n\nDeep Dive into Bray Curtis Dissimilarity\n\n\n\n\n\nWhy do we work out the total counts on each site?\n\nBy dividing by the total abundance across both sites, we normalise the shared abundance, accounting for differences in sample size or total population. This allows the measure to reflect relative similarity rather than absolute counts, ensuring the value ranges between 0 (identical) and 1 (completely different).\nIn other words, calculating totals ensures that the Bray-Curtis dissimilarity is scale-independent and fair across samples of different sizes.\n\n\n\nNow that we have:\n\\[\nC_{ij} = 0.4 \\\\\n\\] \\[\nS_i = 1 \\\\\n\\] \\[\nS_j = 1\n\\]\nThe Bray-Curtis formula is:\n\\[\nBC_{ij} = 1 - \\frac{2 C_{ij}}{S_i + S_j}\n\\]\nPlugging in the values:\n\\[\nBC_{ij} = 1 - \\frac{2*0.4}{1 + 1}\n\\]\nCalculate the division:\n\\[\n\\frac{0.8}{2} = 0.4\n\\]\nFinally:\n\\[\nBC_{ij} = 1 - 0.4 = \\mathbf{0.6}\n\\]\nInterpretation:\nUsing this formula we have worked out the Bray-Curtis Dissimilarity of the two Medfly microbiotas from Argan and Peach to be 0.6.\nNow let‚Äôs go into what this means. Below shows the scale, where Bray-Curtis dissimilarity will range from 0 - 1, with 1 being the largest amount of dissimilarity between the two samples.\n\n\n\n\n\n\n\n\n\nFrom the scale, we can conclude that two samples are not similar, not are they massively dissimilar. But they are more dissimilar than similar! You might be able to see this makes somewhat sense by going back to the dataframe. To put it simply, a Bray-Curtis dissimilarity of 0.6 indicates moderate dissimilarity between the two sites.\n¬†\n\n\n\nJaccard Dissimilarity\nJaccard distance does not take abundances into account; just the presence of microbes in one or both samples.\nThe Jaccard dissimilarity is defined as:\n\\[\n\\text{Jaccard}_{ij} = 1 - \\frac{|A \\cap B|}{|A \\cup B|}\n\\]\nA ‚à© B is the number of shared species (present in both sites).\n¬† A ‚à™ B is the total number of unique species across both sites.\n¬†\nLets take the two samples we used to calculate Bray Curtis Dissimilarity from the Darrington et al.¬†(2022) data again.\n\n\nSample 1 - Medfly from Morocco (Argan üå∞)\nBacterial composition (relative proportions):\n\n\n\nBacterium\nProportion\n\n\n\n\nKlebsiella\n0.75\n\n\nPantonea\n0.15\n\n\nCommensalibacter\n0.10\n\n\n\n\nSample 2 - Medfly from Greece (Peach üçë)\nBacterial composition (relative proportions):\n\n\n\nBacterium\nProportion\n\n\n\n\nKlebsiella\n0.25\n\n\nPantonea\n0.50\n\n\nSerratia\n0.05\n\n\nSpinghobacterium\n0.15\n\n\n\n\n\nIn both the Argan sample, and the Peach sample, there is Klebsiella and Pantonea, this means there are 2 samples which are the same.\nIn the Argan sample, there is Klebsiella, Pantonea and Commensalibacter. In the Peach sample, there is Klebsiella, Pantonea, Serratia and Spinghobacterium, so there are 5 different bacterias present across both of these samples.\nPutting this into a equation is:\n\\[\n\\text{Jaccard}_{ij} = 1 - \\frac{2}{5}\n\\]\n\\[\n\\text{Jaccard}_{ij} = \\frac{2}{5} = 0.4\n\\] \\[\n\\text{Jaccard}_{ij} = 1 - 0.4 = 0.6\n\\]\nOur Jaccard value is 0.6. Jaccard uses the same dissimilarity scale as Bray Curtis, with 0 being very similar, and 1 being completley dissimilar, so this means, like Bray Curtis, there is moderate dissimilarity.\n\n\nBray-Curtis vs.¬†Jaccard\nAn important concept to understand, and something worth testing yourself on, is the difference between the Bray-Curtis and Jaccard dissimilarity measures.\n\nBray-Curtis considers the actual abundance of each bacterial species. It quantifies how different two samples are based on the amount of each bacteria present.\nJaccard, by contrast, uses only presence or absence data. It ignores the amount of each species are found and focuses solely on whether a species is present in either sample.\n\n¬†\n\n\n\n\n\n\n\n\nMetric\nConsiders Abundance?\nBased On\n\n\n\n\nBray-Curtis\nYes\nThe actual count data of the bacteria\n\n\nJaccard\nNo\nPresence/absence of the bacteria\n\n\n\n¬†\nIn short:\n\nBray-Curtis ‚Üí The quantity of each bacteria matters\nJaccard ‚Üí Only the presence/absence of each bacteria matters\n\n\n\nTest your understanding!\n\nWhich of the following best describes the difference between Jaccard and Bray-Curtis dissimilarity?\n\n\n A. Jaccard uses relative abundance, Bray-Curtis uses only presence/absence  B. Jaccard uses presence/absence, Bray-Curtis uses abundance  C. Both use only abundance data  D. They are mathematically identical\n\nSubmit\n\n\n\n\n\n\n\n\nBoth Bray-Curtis and Jaccard use a dissimilarity scale of 0‚Äì1. What does this mean?\n\n\n A. 0 means completely different, 1 means identical  B. 0 means identical, 1 means completely different  C. Both always give the same result  D. The scale measures sample size\n\nSubmit\n\n\n\n\n\n\n\n\nIn both Bray-Curtis and Jaccard dissimilarity, the formula starts with ‚Äú1 -‚Äù. Why is that?\n\n\n A. To invert similarity into dissimilarity  B. Because the equation calculates diversity directly  C. To normalize the values between 0 and 1  D. It‚Äôs an arbitrary choice without meaning\n\nSubmit\n\n\n\n\n\n\n\n\n\n\nCalculate the Bray-Curtis and Jaccard dissimilarity between the following two samples:\n\n\n\n\n\n\nBacterial Species\nSample from Greece\nSample from Victoria, AU\n\n\n\n\nBacillus\n2\n0\n\n\nLactobacillus\n8\n2\n\n\nStreptococcus\n0\n4\n\n\nEscherichia\n2\n2\n\n\nClostridium\n0\n6\n\n\nPseudomonas\n2\n2\n\n\n\nTest data set: this table compares the presence of selected bacterial genera (%) in the Melon fruit fly, with gut samples from Greece and Victoria, Australia.\n\nBray-Curtis dissimilarity: \nJaccard dissimilarity: \n\nSubmit\n\n\n\n\n\n\nReferences:\nBeta Diversity of the Microbiome, Su, 2011.\n\n\n\nThis is the end of Beta Diversity. You are now ready to start learning about Ordination Methods. Please click the button below to begin learning about Principal Component Analysis, an important ordination method!\n\n\n Turn to Principal Component Analysis ‚Üí"
  },
  {
    "objectID": "qmds/NMDS.html",
    "href": "qmds/NMDS.html",
    "title": "Non-Metric Multidimensional Scaling (NMDS)",
    "section": "",
    "text": "Credit: This image was created on Canva..\n\n\n\n\n¬†\n\n\n\n\nNMDS (Non-metric Multidimensional Scaling) is an ordination technique, which is used to visualise similarities or dissimilarities in data. NMDS is used to reduce the dimensionality of complex data sets, (i.e the abundance of microbes across different sites), to allow for visualisation in a 2D space, (although this can be 3D). Unlike PCA, NMDS is a non-linear method. It doesn‚Äôt preserve actual distances between samples, but instead maintains the rank order of those distances, which is especially useful when working with complex samples, such as in ecological or microbial community data.\n\nOrdination: Ordination is a method used to arrange or ‚Äúorder‚Äù samples based on patterns of similarity or dissimilarity in multivariate data. It helps reduce complex, high-dimensional data into a few interpretable axes, often for visualsation. ¬†\n\n\nSimilarities or dissimilarities: These refer to how alike (similar) or different (dissimilar) samples are based on measured variables. In ecological or microbial data, this could mean how similar two sites are in terms of species composition. These are often quantified using a distance matrix (e.g., Bray-Curtis, Jaccard, like discussed in a previous chapter). ¬†\n\n\nRank order of distances: This refers to the relative ordering of distances between samples, not the actual values. For example, if site A is more similar to site B than to site C, NMDS tries to preserve that order.\n\n\n\n\n\n\n\nDeep Dive into Non-metric Multidimensional Scaling\n\n\n\n\n\nWhat does it mean if something is rank-based?\n\nIn a rank-based method like NMDS, the actual numerical distances between samples are not used directly. Instead, the method focuses on the order (or rank) of dissimilarities, i.e., which samples are more similar or more different relative to others.\nThis means that the specific values in the distance matrix are converted to a ranked list, and the ordination tries to preserve that ordering in low-dimensional space. For example, if Sample A is more similar to B than to C, NMDS will try to place A closer to B than to C, regardless of the actual distance values.\nThis approach makes NMDS more flexible and robust to differences in scaling, especially when dealing with ecological or microbiome data that are often noisy.\n\n\n\n\n\n\n\nCalculate a dissimilarity matrix\nUse a dissimilarity measure (e.g., Bray-Curtis) to quantify differences between all sample pairs based on multivariate data (e.g., species abundance).\nRank the dissimilarity values\nConvert the dissimilarity matrix into ranked distances, from most similar to least similar.\nInitialise with random coordinates\nI an a new 2D space, put samples at random starting positions in a low-dimensional space.\nCalculate Euclidean distances\nMeasure the Euclidean distances between all pairs of these random points in the reduced space.\nRank the Euclidean distances\nRank these distances like done with the original dissimilarity differences in Step 2.\nCompare ranked distances using Kruskal‚Äôs stress\nUse Kruskal‚Äôs stress function to compare the ranked dissimilarities with the ranked Euclidean distances. This metric quantifies how well the configuration preserves the order of the original dissimilarities.\nIteratively minimise stress\nAdjust the configuration repeatedly to minimise stress. If the stress is too high, this will be repeated new random configurations.\nObtain the NMDS solution\nThe configuration with the lowest stress provides the final NMDS scores ‚Äî a best-fit representation of the rank-based dissimilarities in reduced space.\nVisualise the results\nPlot the NMDS scores in 2D (or 3D) space, where the distance between points reflects the relative dissimilarity between samples.\n\n\n\n\n\nTo create an NMDS plot for data visualisation, we first need to perform a dissimilarity analysis. In Beta Diversity Analysis, we calculated the Bray Curtis dissimilarity, so let‚Äôs start by replicating that to see how Bray Curtis can be calculated directly in R.\nIn the Beta Diversity chapter, we calculated dissimilarity using a smaller data set of two samples:\n\n\nSample 1 - Medfly from Morocco (Argan üå∞)\nBacterial composition (relative proportions):\n\n\n\nBacterium\nProportion\n\n\n\n\nKlebsiella\n0.75\n\n\nPantonea\n0.15\n\n\nCommensalibacter\n0.10\n\n\n\n\nSample 2 - Medfly from Greece (Peach üçë)\nBacterial composition (relative proportions):\n\n\n\nBacterium\nProportion\n\n\n\n\nKlebsiella\n0.25\n\n\nPantonea\n0.50\n\n\nSerratia\n0.05\n\n\nSpinghobacterium\n0.15\n\n\n\n\n\nFor the purpose of demostrating how we can calculate Bray values in R - we will first put all these values into an R dataframe, and use the Bray Curtis method \"bray\" from the vegdist() function, from the vegan() package.\n\n‚ö†Ô∏è Please Note: The vegist() function with Bray-Curtis dissimilarity (\"bray\") requires no row names in the data frame. To avoid errors, we‚Äôll keep track of sample order manually and omit row names in the dataframe.\n\n\n# Putting together the data frame without the fruit names.\nbacteria_df &lt;- data.frame(\n  Klebsiella = c(0.75, 0.25),\n  Pantonea = c(0.15, 0.50),\n  Commensalibacter = c(0.10, 0.00),\n  Serratia = c(0.00, 0.05),\n  Spinghobacterium = c(0.00, 0.15))\n\n# Using `vegdist()` with our df, and bray curtis for analysis.\nbray_curtis &lt;- vegdist(bacteria_df, method = \"bray\")\n\n# Putting our result back into a matrix, re-adding the fruit names to the rows and colums. \nbray_curtis_matrix &lt;- as.matrix(bray_curtis)\nfruit_names &lt;- c(\"Argan\", \"Peach\")\nrownames(bray_curtis_matrix) &lt;- fruit_names\ncolnames(bray_curtis_matrix) &lt;- fruit_names\n\nbray_curtis_matrix\n\n          Argan     Peach\nArgan 0.0000000 0.5897436\nPeach 0.5897436 0.0000000\n\n\nIf you can remember, in Beta Diversity Analysis: we calculated the Bray-Curtis Dissimilarity for these bacteria across these two samples, to be 0.6, our R output shows the value to be 0.589 - which is somewhat similar. So we are on track, and we at least know how to calculate dissimilarity!\nNow, since one of the key purposes of NMDS is to reduce complex multivariate data into a simple 2D representation, let‚Äôs scale things up by bringing in more samples from the Darrington et al.¬†(2022) dataset.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFruit\nKlebsiella\nAcinetobacter\nPantoea\nPseudoxanthomonas\nSerratia\nStenotrophomonas\nDelftia\nBurkholderia\nSphingomonas\nBacillus\nSphingobacterium\nMycoplasma\n\n\n\n\nApricot\n80%\n10%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n\n\nArgan\n75%\n10%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n5%\n\n\nGF\n75%\n10%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n5%\n\n\nOrange\n70%\n15%\n5%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n\n\nPeach\n60%\n10%\n10%\n10%\n5%\n5%\n0%\n0%\n5%\n5%\n0%\n0%\n\n\nTang\n40%\n10%\n20%\n20%\n10%\n5%\n0%\n5%\n10%\n0%\n0%\n0%\n\n\n\n\n¬†\n\n\nAs demonstrated briefly above, if we are using R to calculate the Bray-Curtis dissimilarity values, we first want to put our data into a dataframe containing the relative abundance of our bacteria for each of the six fruit samples. As we did earlier we will use \"bray\" in the vegdist() function in R to calculate the Bray-Curtis dissimilarity values. Ensuring we are making a dataframe where row names have been ommited.\n\n\n          Apricot     Argan        GF    Orange     Peach      Tang\nApricot 0.0000000 0.1000000 0.1000000 0.1500000 0.3170732 0.5348837\nArgan   0.1000000 0.0000000 0.0000000 0.0952381 0.2558140 0.4666667\nGF      0.1000000 0.0000000 0.0000000 0.0952381 0.2558140 0.4666667\nOrange  0.1500000 0.0952381 0.0952381 0.0000000 0.2093023 0.4222222\nPeach   0.3170732 0.2558140 0.2558140 0.2093023 0.0000000 0.2608696\nTang    0.5348837 0.4666667 0.4666667 0.4222222 0.2608696 0.0000000\n\n\nAs there are many possible pairwise comparisons between fruit samples, we will have multiple Bray-Curtis values. Although the resulting matrix is symmetric and contains repeated values, it effectively shows how bacterial communities vary across different fruits. The Bray-Curtis values of 0 which are shown diagonaly, comparing each fruit to itself confirms that those samples are identical in their bacterial composition - which would make sense, seeing as it‚Äôs the same fruit!\n\n\n\n\n\n\nDeep Dive into Non-metric Multidimensional Scaling\n\n\n\n\n\nDid you notice the other 0 Bray-Curtis value?\n\nIf you are fairly mindful, you might notice that we have a Bray Curtis value of 0, across Argan and Grapefruit, this is because - if you go back to the original dataset, the composition of bacteria is the same across these two fruits. Again confirming that Bray Curtis in veg_dist() is showing us what we were expecting!\n\n\n\n\n\n\nWe have now done pairwise comparisons of the bacterial composition comparing all the different fruit samples. Time to use these to calculate some NMDS stuff!\nThe metaMDS() function:\n\nThe metaMDS() function performs NMDS by using multiple random starts to find a stable solution.\nIt standardises the output for easier interpretation and adds species scores to the site ordination. While metaMDS() itself doesn‚Äôt directly compute NMDS - when we add the relevant information inside this function, it will.\nWe have set k = 2 because we want to reduce the data to two dimensions (simplifying the data).\nThe trymax parameter, set to 100 increases the number of ‚Äúrandom starts‚Äù to help the algorithm find a stable, low-stress solution (stress is something we will go into more detail on in a bit).\nFinally, trace as FALSE, disables the messages where each random start is shown again, because we don‚Äôt need to see that 100 times.\n\n\nNMDS &lt;- metaMDS(bray_curtis, k = 2, trymax = 100, trace = FALSE)\n\n\n\n\n\n\nCredit: This image was created on Canva.\n\n\n\n\n\nShow/Hide NMDS Output\n\n\n\n\nWarning in metaMDS(bray_curtis, k = 2, trymax = 100, trace = FALSE): stress is\n(nearly) zero: you may have insufficient data\n\n\n\nCall:\nmetaMDS(comm = bray_curtis, k = 2, trymax = 100, trace = FALSE) \nglobal Multidimensional Scaling using monoMDS\nData:     bray_curtis \nDistance: bray \nDimensions: 2 \nStress:     0 \nStress type 1, weak ties\nBest solution was not repeated after 100 tries\nThe best solution was from try 0 (metric scaling or null solution)\nScaling: centring, PC rotation, halfchange scaling \nSpecies: scores missing\n\n\n\n\n¬†\nWhen we run NMDS, the above is the output we get. Let‚Äôs go through it a bit!\n\nDimensions 2- we chose to reduce it to two dimensions (k = 2)\n\n\nStress 0 - this is a bit weird, and might indicate our dataframe is a bit too low. We will go into this a bit more later, but low stress is generally meant to be a good thing.\n\n\nStress type 1, weak ties this refers to Kruskal‚Äôs stress formula 1 and ‚Äúweak ties‚Äù means few or no tied ranks\n\n\nBest solution was not repeated after 100 tries Out of 100 random starts, the best solution occurred in the very first try and was not found again, this could indicate a narrow solution space.\n\n\nThe best solution was from try 0 That the best solution came from this suggests metric scaling already gave a perfect (or near-perfect) fit, which is rare.\n\n\nScaling: centring, PC rotation, halfchange scaling Scaling involves 3 steps to improve the interpretibility of the NMDS plot; centering shifts the data so that the origin is the center of the configuration, PC rotation rotates the ordination axes based on principal components for easier interpretation and halfchange scaling scales distances so that one unit corresponds to a 50% change in species composition, aiding ecological interpretation.\n\n\nSpecies: scores missing: this basically shows because we are measuring differences between sites, not species‚Ä¶\n\nGetting the NMDS values: ¬†\nWe use the NMDS output from the metaMDS() function to extract NMDS scores with the scores() function, focusing specifically on sites, as our aim is to compare species composition among Medfly populations reared on different host fruits. Since we specified k = 2, the resulting ordination is visualised in a two-dimensional space.\n\nNMDS_scores &lt;- (scores(NMDS, display = \"sites\"))\n\n\nShow/Hide NMDS_scores\n\n\n\n\n       NMDS1        NMDS2\n1 -0.3503178 -0.009152294\n2 -0.2203243 -0.043294164\n3 -0.2203243 -0.043294164\n4 -0.1225784  0.024445533\n5  0.2334893  0.151762132\n6  0.6800555 -0.080467044\n\n\n\n\n¬†\nGreat, we now have scores for NMDS1 and NMDS2, which represent the position of each site in the reduced 2D ordination space. However, before jumping into visualising these results, it‚Äôs worth taking a moment to understand what these axes actually represent.\nUnlike principal components in PCA, NMDS axes do not have a direct linear interpretation. Instead, NMDS1 and NMDS2 are abstract dimensions that best preserve the rank-order of dissimilarities among sites. In our context, this means that sites (i.e., Medfly populations reared on different fruits) that are plotted closer together in this 2D space have more similar compositions between different sites, while those farther apart are more dissimilar.\nAs we just let R do it for us, we might not really understand how the Bray-Curtis dissimilarity values were used to calculate the NMDS scores - so let‚Äôs talk it through.\n\n\n\nHow do Bray-Curtis dissimilarity values become NMDS scores?\nWhile using R makes this process straightforward, it‚Äôs easy to lose sight of the underlying steps when running functions like metaMDS().\nTo better understand how Bray-Curtis dissimilarities become NMDS scores, let‚Äôs walk through the process in detail.\n\n\n\n\n\nCredit: This image was made on Canva.\n\n\n\n\nWhat is metaMDS() actually doing?\nStep 3.1: Get the dissimilarity values.\n¬† When metaMDS() is running, it starts with the dissimilarity matrix that has been set (in our case Bray-Curtis), and converts the pairwise dissimilarities into ranks. This is because NMDS works on the order of dissimilarities, it tries to preserve which pairs are more similar or dissimilar, rather than the exact numeric values themselves.\nLet‚Äôs take a step back, with some random numbers to exemplify this. Below is an example Bray-Curtis dissimilarity matrix for 4 sites. Note that diagonal entries are 0 because a site is identical to itself:\n\n\n\n\n\nSite\nS1\nS2\nS3\nS4\n\n\n\n\nS1\n0.0\n0.3\n0.7\n0.5\n\n\nS2\n0.3\n0.0\n0.4\n0.6\n\n\nS3\n0.7\n0.4\n0.0\n0.8\n\n\nS4\n0.5\n0.6\n0.8\n0.0\n\n\n\nRandom Pairwise Bray Curtis Dissimilarity values for 4 Sites.\n\n\n¬†\nStep 3.2: Rank the dissimilarity values. ¬†\nNext, metaMDS() ranks these pairwise values from most similar (lowest dissimilarity) to most dissimilar (highest dissimilarity). For example, the pair S1 and S2 has the lowest dissimilarity value of 0.3, so is classed as rank 1. While S3 and S4 have the highestr dissimilarity of 0.8, so is classed as rank 6. If you remember from the Beta Diversity chapter, in Bray Curtis 0 is most similar, while 1 is most dissimilar.\n\n\n\n\n\nPair\nBray-Curtis\nRank\n\n\n\n\nS1‚ÄìS2\n0.3\n1\n\n\nS2‚ÄìS3\n0.4\n2\n\n\nS1‚ÄìS4\n0.5\n3\n\n\nS2‚ÄìS4\n0.6\n4\n\n\nS1‚ÄìS3\n0.7\n5\n\n\nS3‚ÄìS4\n0.8\n6\n\n\n\nA Ranked table of Random Pairwise Bray Curtis Dissimilarity values for 4 Sites.\n\n\n¬†\nStep 3.3: Put new random co-ordinates in a 2D space. ¬†\nIn this step, each site (or sample) is randomly assigned coordinates within a 2D space. These starting positions serve as the initial guess for the NMDS algorithm, which will then iteratively adjust them to best reflect the rank-order of dissimilarities among sites.\n\n\n\n\n\nAn example of how metaMDS() will generate random points. Credit: This image was generated in ChatGPT.\n\n\n\n\n¬†\nStep 3.4: Calculate the Euclidean distances between the two points. ¬†\nAfter doing, this it will calculate the Euclidean distances between every pair of sites of these random ones. Euclidean distances just tells us ‚Äúhow far apart‚Äù two points are in our 2D map, and NMDS eventually wants that ‚Äúhow far apart‚Äù to reflect how different the original sites were based on Bray-Curtis.\nFor example, from the random starting configuration example shown below, you have 2D coordinates for each site. For example let‚Äôs take Site 1, and Site 2.\n\nSite 1 is at (-0.25, 0.8)\nSite 2 is at (0.48, 0.15).\n\n\\[\n\\begin{aligned}\nd &= \\sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2} \\\\\n  &= \\sqrt{(0.48 - (-0.25))^2 + (0.15 - 0.8)^2} \\\\\n  &= \\sqrt{(0.73)^2 + (-0.65)^2} \\\\\n  &= \\sqrt{0.5329 + 0.4225} \\\\\n  &= \\sqrt{0.9554} \\\\\n  &\\approx 0.977\n\\end{aligned}\n\\] Our Euclidean distance between Site 1 and Site 2 is 0.977. ¬†\nStep 3.4: We can then rank the Euclidean distances we found\n\n\n\n\n\nPair\nEuclidean-Distance\nRank\n\n\n\n\nS1‚ÄìS2\n0.977\n1\n\n\nS2‚ÄìS3\n0.978\n2\n\n\nS1‚ÄìS4\n0.980\n3\n\n\nS2‚ÄìS4\n0.986\n4\n\n\nS1‚ÄìS3\n0.990\n5\n\n\nS3‚ÄìS4\n1.000\n6\n\n\n\nA Ranked table of Eucledian distances for 4 Sites.\n\n\n¬†\n¬† Step 3.5: Compare the Bray Curtis and the Euclidean distances ranks together.\n\n\n\n\n\n\n\n\n\n\n\n\nPair\nBray-Curtis\nDissimilarity_Rank\nEuclidean_Distance\nEuclidean_Rank\n\n\n\n\nS1‚ÄìS2\n0.3\n1\n0.977\n1\n\n\nS2‚ÄìS3\n0.4\n2\n0.978\n2\n\n\nS1‚ÄìS4\n0.5\n3\n0.980\n3\n\n\nS2‚ÄìS4\n0.6\n4\n0.986\n4\n\n\nS1‚ÄìS3\n0.7\n5\n0.990\n5\n\n\nS3‚ÄìS4\n0.8\n6\n1.000\n6\n\n\n\nA Ranked comparison table of Bray Curtis dissimilarity values and Eucledian distances for 4 Sites.\n\n\n¬†\nTo help: we can visualise this comparison in a Shephard diagram\n\n\n\n\n\n\n\n\n\n¬†\nStep 3.6: Using these ranked distances together, calculate the stress value.\n¬† With this comparison, we can then calculate a ‚Äústress‚Äù value, this measures how well the distances in the ordination match the ranked Bray-Curtis dissimilarities. One of the goal of metaMDS() is to minimise this stress.\nWe can calculate this stress value, with something called Kruskall‚Äôs Stress Formula:\n\\[\n\\text{Stress} = \\sqrt{\n  \\frac{\n    \\sum_{i&lt;j} \\left( d_{ij} - \\hat{d}_{ij} \\right)^2\n  }{\n    \\sum_{i&lt;j} d_{ij}^2\n  }\n}\n\\]\n\\[\n\\text{The original dissimilarity} = d_{ij}\n\\]\n\\[\n\\text{The Euclidean distance between points} = \\hat{d}_{ij}\n\\] ¬†\nTo make it a bit easier, lets first put a table together so we can start plugging in the values.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPair\nBray-Curtis\nDissimilarity_Rank\nEuclidean_Distance\nEuclidean_Rank\nSquared_Diff\nBray_Curtis_Sq\n\n\n\n\nS1‚ÄìS2\n0.3\n1\n0.977\n1\n0.458329\n0.09\n\n\nS2‚ÄìS3\n0.4\n2\n0.978\n2\n0.334084\n0.16\n\n\nS1‚ÄìS4\n0.5\n3\n0.980\n3\n0.230400\n0.25\n\n\nS2‚ÄìS4\n0.6\n4\n0.986\n4\n0.148996\n0.36\n\n\nS1‚ÄìS3\n0.7\n5\n0.990\n5\n0.084100\n0.49\n\n\nS3‚ÄìS4\n0.8\n6\n1.000\n6\n0.040000\n0.64\n\n\n\n\n\nIn the table, the Bray-Curtis dissimilarity, Euclidean distance, and squared difference represent the components needed for calculating the numerator, for example, (0.3 - 0.977)^2 = 0.458. The denominator is based on the squared value of the Eucledian distances, in this case, 0.977^2 =  0.954529. However, the calculation will be the sum of all of these values.\n\nnumerator &lt;- sum(comparison2$Squared_Diff)\ndenominator &lt;- sum(comparison2$Bray_Curtis_Sq)\nstress &lt;- sqrt(numerator / denominator)\n\n\n\n0.8069762\n\n[1] 0.8069762\n\n\nIf the stress value is too high, you go back, and start some of these processes again, that is:\n\nGenerate new random points in a 2D space.\nMeasure the Eucledian distances.\nRank the Eucledian distances.\nCompare the ranked Eucledian distances with the ranked Bray Curtis dissimilarities.\nPut these into the stress formula!\n\nThe final co-ordinates you end up with are your NMDS scores.\n\n\n\n\n\n\nDeep Dive into Nonmetric Multidimensional Scaling\n\n\n\n\n\nAn inquisitive thought might be, why do we use ranks, if these aren‚Äôt used in the stress formula?\n\nIn NMDS, ranks guide the ordination even though they don‚Äôt appear directly in the stress formula. Rather than preserving exact dissimilarity values, NMDS preserves the rank order of dissimilarities, for example, which pairs are more or less similar.\nNMDS then calculates the Euclidean distances between random points and compares these distances to the original dissimilarities. The key is that the rank order is maintained, not the exact distances.\nStress measures how well the fitted distances match the ordination distances. So, while all distances affect stress, it‚Äôs the ranking that shapes the configuration, ensuring the order of similarities is preserved as closely as possible.\n\n\n\n¬†\nLet‚Äôs look at a ‚Äúreal-life‚Äù analogy to help make sense of this process, imagine you‚Äôre a game of ‚ÄúPin the Medfly on the fruit.‚Äù. In this game, each fruit represents a Bray-Curtis dissimilarity value, and the Medflies represent the Euclidean distances. Your goal is to match the rankings of the Bray-Curtis dissimilarities with the rankings of the Euclidean distances as closely as possible.\n\n\n\n\n\nCredit: This image was made on Canva.\n\n\n\n\nOn your first attempt, the match isn‚Äôt great - your randomly placed Medflies are all over the place! The stress value is high, meaning the ranked Euclidean distances don‚Äôt align well with the ranked Bray-Curtis values. In other words, you‚Äôve done a poor job of pinning the Medflies on the fruit.\n\n\n\n\n\nCredit: This image was made on Canva.\n\n\n\n\nSo, you try again. You generate new random points, recalculate the Eucledian distances, rank them, and compare these ranks to the Bray-Curtis dissimilarity ranks, you try generate the stress value again - ie, you try to pin the Medfly on the fruit again! This process continues until you find a configuration where the ranks match well and your stress value is low. Thus, finally, the Medflies are now closely aligned with their fruits.\n¬†\n\n\n\nWith our NMDS scores calculated and the dimensionality of the ordination space chosen, we‚Äôre now ready to visualise the results in a plot.\nA summary: what do we need for our plot?\n\n# Let's get our bacteria dataframe again\nbacteria_df &lt;- data.frame(\n  Klebsiella = c(0.75, 0.25, 0.5, 0.7, 0.3, 0.75),\n  Pantonea = c(0.15, 0.50, 0.05, 0.03, 0.02, 0.05),\n  Commensalibacter = c(0.10, 0.02, 0.01, 0.01, 0.01, 0.01),\n  Serratia = c(0.01, 0.05, 0.01, 0.01, 0.02, 0.01),\n  Spinghobacterium = c(0.01, 0.15, 0.01, 0.02, 0.01, 0.01),\n  Acinetobacter = c(0.02, 0.01, 0.01, 0.01, 0.5, 0.01)\n)\n\n# Use metaMDS to generate the ordination with lowest stress\ninvisible(capture.output(\n  nmds &lt;- metaMDS(bacteria_df, distance = \"bray\", k = 2, trymax = 100)\n))\n\n# Extract site scores\nnmds_scores &lt;- as.data.frame(scores(nmds, display = \"sites\"))\n\n# Add fruit names\nnmds_scores$Fruit &lt;- c(\"Argan\", \"Peach\", \"Apricot\", \"Grapefruit\", \"Orange\", \"Tangerine\")\n\n# Plot the NMDS results\nnmds_plot &lt;- ggplot(nmds_scores,\n                    aes(x = NMDS1, y = NMDS2, colour = Fruit)) +\n  geom_point(size = 4) +\n  theme_minimal() +\n  labs(title = \"NMDS Plot of Bacterial Composition\",\n       subtitle = \"Colored by Fruit Type\",\n       x = \"NMDS1\", y = \"NMDS2\")\n\n\n\n\n\n\n\n\n\n\n¬†\nAnd finally, we have our NMDS plot! We can see that Tangerine, Grapefruit and Argan have fairly similar bacterial compositions, while Peach and Apricot are more dissimilar."
  },
  {
    "objectID": "qmds/NMDS.html#a-background-to-nmds",
    "href": "qmds/NMDS.html#a-background-to-nmds",
    "title": "Non-Metric Multidimensional Scaling (NMDS)",
    "section": "",
    "text": "NMDS (Non-metric Multidimensional Scaling) is an ordination technique, which is used to visualise similarities or dissimilarities in data. NMDS is used to reduce the dimensionality of complex data sets, (i.e the abundance of microbes across different sites), to allow for visualisation in a 2D space, (although this can be 3D). Unlike PCA, NMDS is a non-linear method. It doesn‚Äôt preserve actual distances between samples, but instead maintains the rank order of those distances, which is especially useful when working with complex samples, such as in ecological or microbial community data.\n\nOrdination: Ordination is a method used to arrange or ‚Äúorder‚Äù samples based on patterns of similarity or dissimilarity in multivariate data. It helps reduce complex, high-dimensional data into a few interpretable axes, often for visualsation. ¬†\n\n\nSimilarities or dissimilarities: These refer to how alike (similar) or different (dissimilar) samples are based on measured variables. In ecological or microbial data, this could mean how similar two sites are in terms of species composition. These are often quantified using a distance matrix (e.g., Bray-Curtis, Jaccard, like discussed in a previous chapter). ¬†\n\n\nRank order of distances: This refers to the relative ordering of distances between samples, not the actual values. For example, if site A is more similar to site B than to site C, NMDS tries to preserve that order.\n\n\n\n\n\n\n\nDeep Dive into Non-metric Multidimensional Scaling\n\n\n\n\n\nWhat does it mean if something is rank-based?\n\nIn a rank-based method like NMDS, the actual numerical distances between samples are not used directly. Instead, the method focuses on the order (or rank) of dissimilarities, i.e., which samples are more similar or more different relative to others.\nThis means that the specific values in the distance matrix are converted to a ranked list, and the ordination tries to preserve that ordering in low-dimensional space. For example, if Sample A is more similar to B than to C, NMDS will try to place A closer to B than to C, regardless of the actual distance values.\nThis approach makes NMDS more flexible and robust to differences in scaling, especially when dealing with ecological or microbiome data that are often noisy.\n\n\n\n\n\n\n\nCalculate a dissimilarity matrix\nUse a dissimilarity measure (e.g., Bray-Curtis) to quantify differences between all sample pairs based on multivariate data (e.g., species abundance).\nRank the dissimilarity values\nConvert the dissimilarity matrix into ranked distances, from most similar to least similar.\nInitialise with random coordinates\nI an a new 2D space, put samples at random starting positions in a low-dimensional space.\nCalculate Euclidean distances\nMeasure the Euclidean distances between all pairs of these random points in the reduced space.\nRank the Euclidean distances\nRank these distances like done with the original dissimilarity differences in Step 2.\nCompare ranked distances using Kruskal‚Äôs stress\nUse Kruskal‚Äôs stress function to compare the ranked dissimilarities with the ranked Euclidean distances. This metric quantifies how well the configuration preserves the order of the original dissimilarities.\nIteratively minimise stress\nAdjust the configuration repeatedly to minimise stress. If the stress is too high, this will be repeated new random configurations.\nObtain the NMDS solution\nThe configuration with the lowest stress provides the final NMDS scores ‚Äî a best-fit representation of the rank-based dissimilarities in reduced space.\nVisualise the results\nPlot the NMDS scores in 2D (or 3D) space, where the distance between points reflects the relative dissimilarity between samples."
  },
  {
    "objectID": "qmds/NMDS.html#nmds-in-action",
    "href": "qmds/NMDS.html#nmds-in-action",
    "title": "Non-Metric Multidimensional Scaling (NMDS)",
    "section": "",
    "text": "To create an NMDS plot for data visualisation, we first need to perform a dissimilarity analysis. In Beta Diversity Analysis, we calculated the Bray Curtis dissimilarity, so let‚Äôs start by replicating that to see how Bray Curtis can be calculated directly in R.\nIn the Beta Diversity chapter, we calculated dissimilarity using a smaller data set of two samples:\n\n\nSample 1 - Medfly from Morocco (Argan üå∞)\nBacterial composition (relative proportions):\n\n\n\nBacterium\nProportion\n\n\n\n\nKlebsiella\n0.75\n\n\nPantonea\n0.15\n\n\nCommensalibacter\n0.10\n\n\n\n\nSample 2 - Medfly from Greece (Peach üçë)\nBacterial composition (relative proportions):\n\n\n\nBacterium\nProportion\n\n\n\n\nKlebsiella\n0.25\n\n\nPantonea\n0.50\n\n\nSerratia\n0.05\n\n\nSpinghobacterium\n0.15\n\n\n\n\n\nFor the purpose of demostrating how we can calculate Bray values in R - we will first put all these values into an R dataframe, and use the Bray Curtis method \"bray\" from the vegdist() function, from the vegan() package.\n\n‚ö†Ô∏è Please Note: The vegist() function with Bray-Curtis dissimilarity (\"bray\") requires no row names in the data frame. To avoid errors, we‚Äôll keep track of sample order manually and omit row names in the dataframe.\n\n\n# Putting together the data frame without the fruit names.\nbacteria_df &lt;- data.frame(\n  Klebsiella = c(0.75, 0.25),\n  Pantonea = c(0.15, 0.50),\n  Commensalibacter = c(0.10, 0.00),\n  Serratia = c(0.00, 0.05),\n  Spinghobacterium = c(0.00, 0.15))\n\n# Using `vegdist()` with our df, and bray curtis for analysis.\nbray_curtis &lt;- vegdist(bacteria_df, method = \"bray\")\n\n# Putting our result back into a matrix, re-adding the fruit names to the rows and colums. \nbray_curtis_matrix &lt;- as.matrix(bray_curtis)\nfruit_names &lt;- c(\"Argan\", \"Peach\")\nrownames(bray_curtis_matrix) &lt;- fruit_names\ncolnames(bray_curtis_matrix) &lt;- fruit_names\n\nbray_curtis_matrix\n\n          Argan     Peach\nArgan 0.0000000 0.5897436\nPeach 0.5897436 0.0000000\n\n\nIf you can remember, in Beta Diversity Analysis: we calculated the Bray-Curtis Dissimilarity for these bacteria across these two samples, to be 0.6, our R output shows the value to be 0.589 - which is somewhat similar. So we are on track, and we at least know how to calculate dissimilarity!\nNow, since one of the key purposes of NMDS is to reduce complex multivariate data into a simple 2D representation, let‚Äôs scale things up by bringing in more samples from the Darrington et al.¬†(2022) dataset.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFruit\nKlebsiella\nAcinetobacter\nPantoea\nPseudoxanthomonas\nSerratia\nStenotrophomonas\nDelftia\nBurkholderia\nSphingomonas\nBacillus\nSphingobacterium\nMycoplasma\n\n\n\n\nApricot\n80%\n10%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n\n\nArgan\n75%\n10%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n5%\n\n\nGF\n75%\n10%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n5%\n\n\nOrange\n70%\n15%\n5%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n\n\nPeach\n60%\n10%\n10%\n10%\n5%\n5%\n0%\n0%\n5%\n5%\n0%\n0%\n\n\nTang\n40%\n10%\n20%\n20%\n10%\n5%\n0%\n5%\n10%\n0%\n0%\n0%\n\n\n\n\n¬†\n\n\nAs demonstrated briefly above, if we are using R to calculate the Bray-Curtis dissimilarity values, we first want to put our data into a dataframe containing the relative abundance of our bacteria for each of the six fruit samples. As we did earlier we will use \"bray\" in the vegdist() function in R to calculate the Bray-Curtis dissimilarity values. Ensuring we are making a dataframe where row names have been ommited.\n\n\n          Apricot     Argan        GF    Orange     Peach      Tang\nApricot 0.0000000 0.1000000 0.1000000 0.1500000 0.3170732 0.5348837\nArgan   0.1000000 0.0000000 0.0000000 0.0952381 0.2558140 0.4666667\nGF      0.1000000 0.0000000 0.0000000 0.0952381 0.2558140 0.4666667\nOrange  0.1500000 0.0952381 0.0952381 0.0000000 0.2093023 0.4222222\nPeach   0.3170732 0.2558140 0.2558140 0.2093023 0.0000000 0.2608696\nTang    0.5348837 0.4666667 0.4666667 0.4222222 0.2608696 0.0000000\n\n\nAs there are many possible pairwise comparisons between fruit samples, we will have multiple Bray-Curtis values. Although the resulting matrix is symmetric and contains repeated values, it effectively shows how bacterial communities vary across different fruits. The Bray-Curtis values of 0 which are shown diagonaly, comparing each fruit to itself confirms that those samples are identical in their bacterial composition - which would make sense, seeing as it‚Äôs the same fruit!\n\n\n\n\n\n\nDeep Dive into Non-metric Multidimensional Scaling\n\n\n\n\n\nDid you notice the other 0 Bray-Curtis value?\n\nIf you are fairly mindful, you might notice that we have a Bray Curtis value of 0, across Argan and Grapefruit, this is because - if you go back to the original dataset, the composition of bacteria is the same across these two fruits. Again confirming that Bray Curtis in veg_dist() is showing us what we were expecting!\n\n\n\n\n\n\nWe have now done pairwise comparisons of the bacterial composition comparing all the different fruit samples. Time to use these to calculate some NMDS stuff!\nThe metaMDS() function:\n\nThe metaMDS() function performs NMDS by using multiple random starts to find a stable solution.\nIt standardises the output for easier interpretation and adds species scores to the site ordination. While metaMDS() itself doesn‚Äôt directly compute NMDS - when we add the relevant information inside this function, it will.\nWe have set k = 2 because we want to reduce the data to two dimensions (simplifying the data).\nThe trymax parameter, set to 100 increases the number of ‚Äúrandom starts‚Äù to help the algorithm find a stable, low-stress solution (stress is something we will go into more detail on in a bit).\nFinally, trace as FALSE, disables the messages where each random start is shown again, because we don‚Äôt need to see that 100 times.\n\n\nNMDS &lt;- metaMDS(bray_curtis, k = 2, trymax = 100, trace = FALSE)\n\n\n\n\n\n\nCredit: This image was created on Canva.\n\n\n\n\n\nShow/Hide NMDS Output\n\n\n\n\nWarning in metaMDS(bray_curtis, k = 2, trymax = 100, trace = FALSE): stress is\n(nearly) zero: you may have insufficient data\n\n\n\nCall:\nmetaMDS(comm = bray_curtis, k = 2, trymax = 100, trace = FALSE) \nglobal Multidimensional Scaling using monoMDS\nData:     bray_curtis \nDistance: bray \nDimensions: 2 \nStress:     0 \nStress type 1, weak ties\nBest solution was not repeated after 100 tries\nThe best solution was from try 0 (metric scaling or null solution)\nScaling: centring, PC rotation, halfchange scaling \nSpecies: scores missing\n\n\n\n\n¬†\nWhen we run NMDS, the above is the output we get. Let‚Äôs go through it a bit!\n\nDimensions 2- we chose to reduce it to two dimensions (k = 2)\n\n\nStress 0 - this is a bit weird, and might indicate our dataframe is a bit too low. We will go into this a bit more later, but low stress is generally meant to be a good thing.\n\n\nStress type 1, weak ties this refers to Kruskal‚Äôs stress formula 1 and ‚Äúweak ties‚Äù means few or no tied ranks\n\n\nBest solution was not repeated after 100 tries Out of 100 random starts, the best solution occurred in the very first try and was not found again, this could indicate a narrow solution space.\n\n\nThe best solution was from try 0 That the best solution came from this suggests metric scaling already gave a perfect (or near-perfect) fit, which is rare.\n\n\nScaling: centring, PC rotation, halfchange scaling Scaling involves 3 steps to improve the interpretibility of the NMDS plot; centering shifts the data so that the origin is the center of the configuration, PC rotation rotates the ordination axes based on principal components for easier interpretation and halfchange scaling scales distances so that one unit corresponds to a 50% change in species composition, aiding ecological interpretation.\n\n\nSpecies: scores missing: this basically shows because we are measuring differences between sites, not species‚Ä¶\n\nGetting the NMDS values: ¬†\nWe use the NMDS output from the metaMDS() function to extract NMDS scores with the scores() function, focusing specifically on sites, as our aim is to compare species composition among Medfly populations reared on different host fruits. Since we specified k = 2, the resulting ordination is visualised in a two-dimensional space.\n\nNMDS_scores &lt;- (scores(NMDS, display = \"sites\"))\n\n\nShow/Hide NMDS_scores\n\n\n\n\n       NMDS1        NMDS2\n1 -0.3503178 -0.009152294\n2 -0.2203243 -0.043294164\n3 -0.2203243 -0.043294164\n4 -0.1225784  0.024445533\n5  0.2334893  0.151762132\n6  0.6800555 -0.080467044\n\n\n\n\n¬†\nGreat, we now have scores for NMDS1 and NMDS2, which represent the position of each site in the reduced 2D ordination space. However, before jumping into visualising these results, it‚Äôs worth taking a moment to understand what these axes actually represent.\nUnlike principal components in PCA, NMDS axes do not have a direct linear interpretation. Instead, NMDS1 and NMDS2 are abstract dimensions that best preserve the rank-order of dissimilarities among sites. In our context, this means that sites (i.e., Medfly populations reared on different fruits) that are plotted closer together in this 2D space have more similar compositions between different sites, while those farther apart are more dissimilar.\nAs we just let R do it for us, we might not really understand how the Bray-Curtis dissimilarity values were used to calculate the NMDS scores - so let‚Äôs talk it through.\n\n\n\nHow do Bray-Curtis dissimilarity values become NMDS scores?\nWhile using R makes this process straightforward, it‚Äôs easy to lose sight of the underlying steps when running functions like metaMDS().\nTo better understand how Bray-Curtis dissimilarities become NMDS scores, let‚Äôs walk through the process in detail.\n\n\n\n\n\nCredit: This image was made on Canva.\n\n\n\n\nWhat is metaMDS() actually doing?\nStep 3.1: Get the dissimilarity values.\n¬† When metaMDS() is running, it starts with the dissimilarity matrix that has been set (in our case Bray-Curtis), and converts the pairwise dissimilarities into ranks. This is because NMDS works on the order of dissimilarities, it tries to preserve which pairs are more similar or dissimilar, rather than the exact numeric values themselves.\nLet‚Äôs take a step back, with some random numbers to exemplify this. Below is an example Bray-Curtis dissimilarity matrix for 4 sites. Note that diagonal entries are 0 because a site is identical to itself:\n\n\n\n\n\nSite\nS1\nS2\nS3\nS4\n\n\n\n\nS1\n0.0\n0.3\n0.7\n0.5\n\n\nS2\n0.3\n0.0\n0.4\n0.6\n\n\nS3\n0.7\n0.4\n0.0\n0.8\n\n\nS4\n0.5\n0.6\n0.8\n0.0\n\n\n\nRandom Pairwise Bray Curtis Dissimilarity values for 4 Sites.\n\n\n¬†\nStep 3.2: Rank the dissimilarity values. ¬†\nNext, metaMDS() ranks these pairwise values from most similar (lowest dissimilarity) to most dissimilar (highest dissimilarity). For example, the pair S1 and S2 has the lowest dissimilarity value of 0.3, so is classed as rank 1. While S3 and S4 have the highestr dissimilarity of 0.8, so is classed as rank 6. If you remember from the Beta Diversity chapter, in Bray Curtis 0 is most similar, while 1 is most dissimilar.\n\n\n\n\n\nPair\nBray-Curtis\nRank\n\n\n\n\nS1‚ÄìS2\n0.3\n1\n\n\nS2‚ÄìS3\n0.4\n2\n\n\nS1‚ÄìS4\n0.5\n3\n\n\nS2‚ÄìS4\n0.6\n4\n\n\nS1‚ÄìS3\n0.7\n5\n\n\nS3‚ÄìS4\n0.8\n6\n\n\n\nA Ranked table of Random Pairwise Bray Curtis Dissimilarity values for 4 Sites.\n\n\n¬†\nStep 3.3: Put new random co-ordinates in a 2D space. ¬†\nIn this step, each site (or sample) is randomly assigned coordinates within a 2D space. These starting positions serve as the initial guess for the NMDS algorithm, which will then iteratively adjust them to best reflect the rank-order of dissimilarities among sites.\n\n\n\n\n\nAn example of how metaMDS() will generate random points. Credit: This image was generated in ChatGPT.\n\n\n\n\n¬†\nStep 3.4: Calculate the Euclidean distances between the two points. ¬†\nAfter doing, this it will calculate the Euclidean distances between every pair of sites of these random ones. Euclidean distances just tells us ‚Äúhow far apart‚Äù two points are in our 2D map, and NMDS eventually wants that ‚Äúhow far apart‚Äù to reflect how different the original sites were based on Bray-Curtis.\nFor example, from the random starting configuration example shown below, you have 2D coordinates for each site. For example let‚Äôs take Site 1, and Site 2.\n\nSite 1 is at (-0.25, 0.8)\nSite 2 is at (0.48, 0.15).\n\n\\[\n\\begin{aligned}\nd &= \\sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2} \\\\\n  &= \\sqrt{(0.48 - (-0.25))^2 + (0.15 - 0.8)^2} \\\\\n  &= \\sqrt{(0.73)^2 + (-0.65)^2} \\\\\n  &= \\sqrt{0.5329 + 0.4225} \\\\\n  &= \\sqrt{0.9554} \\\\\n  &\\approx 0.977\n\\end{aligned}\n\\] Our Euclidean distance between Site 1 and Site 2 is 0.977. ¬†\nStep 3.4: We can then rank the Euclidean distances we found\n\n\n\n\n\nPair\nEuclidean-Distance\nRank\n\n\n\n\nS1‚ÄìS2\n0.977\n1\n\n\nS2‚ÄìS3\n0.978\n2\n\n\nS1‚ÄìS4\n0.980\n3\n\n\nS2‚ÄìS4\n0.986\n4\n\n\nS1‚ÄìS3\n0.990\n5\n\n\nS3‚ÄìS4\n1.000\n6\n\n\n\nA Ranked table of Eucledian distances for 4 Sites.\n\n\n¬†\n¬† Step 3.5: Compare the Bray Curtis and the Euclidean distances ranks together.\n\n\n\n\n\n\n\n\n\n\n\n\nPair\nBray-Curtis\nDissimilarity_Rank\nEuclidean_Distance\nEuclidean_Rank\n\n\n\n\nS1‚ÄìS2\n0.3\n1\n0.977\n1\n\n\nS2‚ÄìS3\n0.4\n2\n0.978\n2\n\n\nS1‚ÄìS4\n0.5\n3\n0.980\n3\n\n\nS2‚ÄìS4\n0.6\n4\n0.986\n4\n\n\nS1‚ÄìS3\n0.7\n5\n0.990\n5\n\n\nS3‚ÄìS4\n0.8\n6\n1.000\n6\n\n\n\nA Ranked comparison table of Bray Curtis dissimilarity values and Eucledian distances for 4 Sites.\n\n\n¬†\nTo help: we can visualise this comparison in a Shephard diagram\n\n\n\n\n\n\n\n\n\n¬†\nStep 3.6: Using these ranked distances together, calculate the stress value.\n¬† With this comparison, we can then calculate a ‚Äústress‚Äù value, this measures how well the distances in the ordination match the ranked Bray-Curtis dissimilarities. One of the goal of metaMDS() is to minimise this stress.\nWe can calculate this stress value, with something called Kruskall‚Äôs Stress Formula:\n\\[\n\\text{Stress} = \\sqrt{\n  \\frac{\n    \\sum_{i&lt;j} \\left( d_{ij} - \\hat{d}_{ij} \\right)^2\n  }{\n    \\sum_{i&lt;j} d_{ij}^2\n  }\n}\n\\]\n\\[\n\\text{The original dissimilarity} = d_{ij}\n\\]\n\\[\n\\text{The Euclidean distance between points} = \\hat{d}_{ij}\n\\] ¬†\nTo make it a bit easier, lets first put a table together so we can start plugging in the values.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPair\nBray-Curtis\nDissimilarity_Rank\nEuclidean_Distance\nEuclidean_Rank\nSquared_Diff\nBray_Curtis_Sq\n\n\n\n\nS1‚ÄìS2\n0.3\n1\n0.977\n1\n0.458329\n0.09\n\n\nS2‚ÄìS3\n0.4\n2\n0.978\n2\n0.334084\n0.16\n\n\nS1‚ÄìS4\n0.5\n3\n0.980\n3\n0.230400\n0.25\n\n\nS2‚ÄìS4\n0.6\n4\n0.986\n4\n0.148996\n0.36\n\n\nS1‚ÄìS3\n0.7\n5\n0.990\n5\n0.084100\n0.49\n\n\nS3‚ÄìS4\n0.8\n6\n1.000\n6\n0.040000\n0.64\n\n\n\n\n\nIn the table, the Bray-Curtis dissimilarity, Euclidean distance, and squared difference represent the components needed for calculating the numerator, for example, (0.3 - 0.977)^2 = 0.458. The denominator is based on the squared value of the Eucledian distances, in this case, 0.977^2 =  0.954529. However, the calculation will be the sum of all of these values.\n\nnumerator &lt;- sum(comparison2$Squared_Diff)\ndenominator &lt;- sum(comparison2$Bray_Curtis_Sq)\nstress &lt;- sqrt(numerator / denominator)\n\n\n\n0.8069762\n\n[1] 0.8069762\n\n\nIf the stress value is too high, you go back, and start some of these processes again, that is:\n\nGenerate new random points in a 2D space.\nMeasure the Eucledian distances.\nRank the Eucledian distances.\nCompare the ranked Eucledian distances with the ranked Bray Curtis dissimilarities.\nPut these into the stress formula!\n\nThe final co-ordinates you end up with are your NMDS scores.\n\n\n\n\n\n\nDeep Dive into Nonmetric Multidimensional Scaling\n\n\n\n\n\nAn inquisitive thought might be, why do we use ranks, if these aren‚Äôt used in the stress formula?\n\nIn NMDS, ranks guide the ordination even though they don‚Äôt appear directly in the stress formula. Rather than preserving exact dissimilarity values, NMDS preserves the rank order of dissimilarities, for example, which pairs are more or less similar.\nNMDS then calculates the Euclidean distances between random points and compares these distances to the original dissimilarities. The key is that the rank order is maintained, not the exact distances.\nStress measures how well the fitted distances match the ordination distances. So, while all distances affect stress, it‚Äôs the ranking that shapes the configuration, ensuring the order of similarities is preserved as closely as possible.\n\n\n\n¬†\nLet‚Äôs look at a ‚Äúreal-life‚Äù analogy to help make sense of this process, imagine you‚Äôre a game of ‚ÄúPin the Medfly on the fruit.‚Äù. In this game, each fruit represents a Bray-Curtis dissimilarity value, and the Medflies represent the Euclidean distances. Your goal is to match the rankings of the Bray-Curtis dissimilarities with the rankings of the Euclidean distances as closely as possible.\n\n\n\n\n\nCredit: This image was made on Canva.\n\n\n\n\nOn your first attempt, the match isn‚Äôt great - your randomly placed Medflies are all over the place! The stress value is high, meaning the ranked Euclidean distances don‚Äôt align well with the ranked Bray-Curtis values. In other words, you‚Äôve done a poor job of pinning the Medflies on the fruit.\n\n\n\n\n\nCredit: This image was made on Canva.\n\n\n\n\nSo, you try again. You generate new random points, recalculate the Eucledian distances, rank them, and compare these ranks to the Bray-Curtis dissimilarity ranks, you try generate the stress value again - ie, you try to pin the Medfly on the fruit again! This process continues until you find a configuration where the ranks match well and your stress value is low. Thus, finally, the Medflies are now closely aligned with their fruits.\n¬†\n\n\n\nWith our NMDS scores calculated and the dimensionality of the ordination space chosen, we‚Äôre now ready to visualise the results in a plot.\nA summary: what do we need for our plot?\n\n# Let's get our bacteria dataframe again\nbacteria_df &lt;- data.frame(\n  Klebsiella = c(0.75, 0.25, 0.5, 0.7, 0.3, 0.75),\n  Pantonea = c(0.15, 0.50, 0.05, 0.03, 0.02, 0.05),\n  Commensalibacter = c(0.10, 0.02, 0.01, 0.01, 0.01, 0.01),\n  Serratia = c(0.01, 0.05, 0.01, 0.01, 0.02, 0.01),\n  Spinghobacterium = c(0.01, 0.15, 0.01, 0.02, 0.01, 0.01),\n  Acinetobacter = c(0.02, 0.01, 0.01, 0.01, 0.5, 0.01)\n)\n\n# Use metaMDS to generate the ordination with lowest stress\ninvisible(capture.output(\n  nmds &lt;- metaMDS(bacteria_df, distance = \"bray\", k = 2, trymax = 100)\n))\n\n# Extract site scores\nnmds_scores &lt;- as.data.frame(scores(nmds, display = \"sites\"))\n\n# Add fruit names\nnmds_scores$Fruit &lt;- c(\"Argan\", \"Peach\", \"Apricot\", \"Grapefruit\", \"Orange\", \"Tangerine\")\n\n# Plot the NMDS results\nnmds_plot &lt;- ggplot(nmds_scores,\n                    aes(x = NMDS1, y = NMDS2, colour = Fruit)) +\n  geom_point(size = 4) +\n  theme_minimal() +\n  labs(title = \"NMDS Plot of Bacterial Composition\",\n       subtitle = \"Colored by Fruit Type\",\n       x = \"NMDS1\", y = \"NMDS2\")\n\n\n\n\n\n\n\n\n\n\n¬†\nAnd finally, we have our NMDS plot! We can see that Tangerine, Grapefruit and Argan have fairly similar bacterial compositions, while Peach and Apricot are more dissimilar."
  },
  {
    "objectID": "qmds/PCA.html",
    "href": "qmds/PCA.html",
    "title": "Principal Component Analysis (PCA)",
    "section": "",
    "text": "Credit: This image was created on Canva."
  },
  {
    "objectID": "qmds/PCA.html#a-background-to-pca",
    "href": "qmds/PCA.html#a-background-to-pca",
    "title": "Principal Component Analysis (PCA)",
    "section": "A background to PCA",
    "text": "A background to PCA\n¬†\n\nWhat is PCA?\nPrincipal Component Analysis (PCA) is a visualisation method that simplifies complex data by reducing it to just a few key dimensions. It helps you visualise patterns: points that appear close together on the plot are more similar, while those farther apart are more different. PCA works best when the data exhibits linear relationships, as it captures variation along straight-line directions in the data.\nThis similarity is often based on Euclidean distance, which measures the straight-line distance between data points in the reduced space. PCA ensures that this reduced space still captures the most important variation in the data, so Euclidean distances between points remain meaningful.\n¬†\n\n\nBreaking it down into a few key points‚Ä¶\n\nPCA reduces the dimensionality of datasets with a lot of different variables and transforms highly correlated variables together into a smaller set of uncorrelated components.\nThis method clusts together correlated variables by finding the covariance matrix of the data, that allows one to see the relationship between different variables, and identifying its principal components, which are defined by their eigenvalues and eigenvectors.\nEigenvalues can be used to work out which are the first two, or three (depending on how many are being used) principal components of the dataset, while the eigenvectors will be used directly in the calculation of the principal components, along with the raw but centered data.\n\n\nCentered data: where the raw data has had the overall mean of its group substracted from it.\n\n\nCovariance matrix: a matrix that summarises the relationships between variables in a dataset, looks at how the variables change together.\n\n\nEigenvalues: numerical values that represent the amount of data explained by each of the principal components.\n\n\nEigenvectors: unit vectors (numerical values) that indicate the direction of the principal components.\n\n¬† To make it easier, lets look at it step by step ‚Ä¶\n¬†\n\n\nThe key steps to PCA:\n\nScale the data (work out the mean composition of each bacteria).\nCentre the data (subtract the column means from the bacteria composition).\nFind the covariance matrix values using the centered data.\nCalculate the eigenvalues and eigenvectors with the covariance matrix values.\nCalculate the principal component spaces.\nGenerate the PCA plot.\n\n¬†\n\n\n\n\n\n\nCredit: This image was created on Canva."
  },
  {
    "objectID": "qmds/PCA.html#pca-in-action",
    "href": "qmds/PCA.html#pca-in-action",
    "title": "Principal Component Analysis (PCA)",
    "section": "PCA in action",
    "text": "PCA in action\nNow we know a little bit more about PCA, let‚Äôs use PCA to understand some data using the dataset from Darrington et al.¬†(2022).\n¬†\nAs mentioned throughout this website, in this study, Medflies were reared on six different fruit types, and their microbiota composition was analysed. So this dataset will allow us to use PCA to visualise how microbiota communities differ depending on the fruit substrate if which the Medflies were reared.\nIf you would like to understand a little more about this study, please see: The Home Page\n¬†\nTable 1: Relative abundance (%) of bacterial genera on the surfaces of different fruits. Please scroll sideways to see the entire table.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFruit\nKlebsiella\nAcinetobacter\nPantoea\nPseudoxanthomonas\nSerratia\nStenotrophomonas\nDelftia\nBurkholderia\nSphingomonas\nBacillus\nSphingobacterium\nMycoplasma\n\n\n\n\nApricot\n80%\n10%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n\n\nArgan\n75%\n10%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n5%\n\n\nGrapefruit\n75%\n10%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n5%\n\n\nOrange\n70%\n15%\n5%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n\n\nPeach\n60%\n10%\n10%\n10%\n5%\n5%\n0%\n0%\n5%\n5%\n0%\n0%\n\n\nTang\n40%\n10%\n20%\n20%\n10%\n5%\n0%\n5%\n10%\n0%\n0%\n0%\n\n\n\n\n¬†\n\nStep 1: Scaling the data\nAs seen above, in the key steps to PCA, our first step is to use our data - and scale it! This involves calculating the mean composition of each bacterial relative abundance across all samples.\n¬†\nTable 2: Relative abundance (%) of bacterial genera on the surfaces of different fruits. Please scroll sideways to see the entire table.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFruit\nKlebsiella\nAcinetobacter\nPantoea\nPseudoxanthomonas\nSerratia\nStenotrophomonas\nDelftia\nBurkholderia\nSphingomonas\nBacillus\nSphingobacterium\nMycoplasma\n\n\n\n\nApricot\n80%\n10%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n\n\nArgan\n75%\n10%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n5%\n\n\nGF\n75%\n10%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n5%\n\n\nOrange\n70%\n15%\n5%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n\n\nPeach\n60%\n10%\n10%\n10%\n5%\n5%\n0%\n0%\n5%\n5%\n0%\n0%\n\n\nTang\n40%\n10%\n20%\n20%\n10%\n5%\n0%\n5%\n10%\n0%\n0%\n0%\n\n\nMean\n66.7%\n10.8%\n7.5%\n7.5%\n3.3%\n1.7%\n0%\n0.8%\n2.5%\n0.8%\n1.7%\n3.3%\n\n\n\n\n¬†\n¬†\n\n\nStep 2: Centering the data\nOur next step is to centre the data. We can do this by subtracting the mean composition (which was calculated in Step 1) from each individual value in the data-set. This step adjusts each bacterial taxa so that its average value across all samples becomes zero.\n\n\n\n\n\n\nDeep Dive into Principal Component Analysis\n\n\n\n\n\nWhy do we want the average across the samples to be zero?\n\nPCA is all about variation, not about absolute values. We need to make the average value across zero, so there is no biasing. Say if the abundance of bacteria 1 was 66%, and the bacteria 2 was 5%, if we don‚Äôt center this - PCA may think that bacteria is way more important, just because there is more of it, but PCA is not about this, it‚Äôs all about how bacteria varies and works together with one another.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFruit\nKlebsiella\nAcinetobacter\nPantoea\nPseudoxanthomonas\nSerratia\nStenotrophomonas\nDelftia\nBurkholderia\nSphingomonas\nBacillus\nSphingobacterium\nMycoplasma\n\n\n\n\nApricot\n13.3%\n-0.8%\n-7.5%\n-7.5%\n-3.3%\n-1.7%\n0%\n-0.8%\n-2.5%\n-0.8%\n-1.7%\n1.7%\n\n\nArgan\n8.3%\n-0.8%\n-2.5%\n-2.5%\n-3.3%\n-1.7%\n0%\n-0.8%\n-2.5%\n-0.8%\n3.3%\n1.7%\n\n\nGF\n8.3%\n-0.8%\n-2.5%\n-2.5%\n-3.3%\n-1.7%\n0%\n-0.8%\n-2.5%\n-0.8%\n3.3%\n1.7%\n\n\nOrange\n3.3%\n4.2%\n-2.5%\n-2.5%\n1.7%\n-1.7%\n0%\n-0.8%\n-2.5%\n-0.8%\n-1.7%\n1.7%\n\n\nPeach\n-6.7%\n-0.8%\n2.5%\n2.5%\n1.7%\n3.3%\n0%\n-0.8%\n2.5%\n4.2%\n-1.7%\n-3.3%\n\n\nTang\n-26.7%\n-0.8%\n12.5%\n12.5%\n6.7%\n3.3%\n0%\n4.2%\n7.5%\n-0.8%\n-1.0%\n-3.3%\n\n\n\n\n¬†\n¬†\n¬†\n\n\nStep 3: Calculate the co-variance matrix values\nOnce the data has been mean-centered, we apply the covariance formula to assess the relationships between the bacterial compositions across samples. Covariance measures how much two variables change together.\nThe population covariance is:\n\\[\n\\text{Cov}_{\\text{population}} = \\frac{\\sum (x_i - \\bar{x})(y_i - \\bar{y})}{n}\n\\]\nThe sample covariance is:\n\\[\n\\text{Cov}_{\\text{sample}} = \\frac{\\sum (x_i - \\bar{x})(y_i - \\bar{y})}{n-1}\n\\]\n¬†\nBreaking down the formula\n\\[\n( x_i - \\bar{x} )\n\\]\nThis represents the centered value of variable ( x ) ‚Äî how far one fruit‚Äôs measurement (e.g., Klebsiella abundance) is from the average across all fruits.\n\\[\n( y_i - \\bar{y} )\n\\]\nThis represents the centered value of variable ( y ) ‚Äî for example, how much another bacterial feature (like Acinetobacter) deviates from its average.\n¬†\n\\[\n( n - 1 )\n\\] This is the total number of samples minus one. We divide by ( n - 1 ) instead of ( n ) because we‚Äôre working with a sample, not the entire population ‚Äî this is known as Bessel‚Äôs correction.\n¬†\nUsing the co-variance formula, and calculating the mean centered data - we can try calculate our covariance matrix values. We have two options, we can either jump straight to using R, OR, we can first give ourselves a bit of an understanding of how they are calculated manually - so we really understand the method‚Ä¶\n¬†\n\n3.1 Calculating the covariance matrix values manually\nWith our previously calculated mean centered data, lets work out the co-variance matrix of Klebsiella and Acinetobacter, and the presence of how these bacteria act together across the different fruits. ¬†\nCovariance Calculation of Klebsiella vs Acinetobacter:\n\n\n\nFruit\nKlebsiella\nAcinetobacter\n\n\n\n\nApricot\n13.3%\n-0.8%\n\n\nArgan\n8.3%\n-0.8%\n\n\nGF\n8.3%\n-0.8%\n\n\nOrange\n3.3%\n4.2%\n\n\nPeach\n-6.7%\n-0.8%\n\n\nTangerine\n-26.7%\n-0.8%\n\n\n\nLet‚Äôs quickly tae just these two bacteria from the table above where we calculated the centered values, the top of the formula, tells us to multiple the centered values of one bacteria, by another bacteria. So let‚Äôs do that for all of them.\nApricot: \\[\n( x_i - \\bar{x} ) ( y_i - \\bar{y} ) = ( 13.3 ) ( -0.8 ) = -10.64\n\\]\n\nNow lets do these for all of the fruits.\n\n\\[\\begin{align*}\n&Apricot:(13.3)*(-0.8) = -10.64 \\\\\n&Argan:(8.3)*(-0.8) = -6.64 \\\\\n&Grapefruit:(8.3)*(-0.8) = -6.64 \\\\\n&Orange:(3.3)*(4.2) = 13.86 \\\\\n&Peach:(-6.7)*(-0.8) = 5.36 \\\\\n&Tangerine:(-26.7)*(-0.8) =  21.36 \\\\\n\\end{align*}\\]\n\nSum the results\n\n\\[\\begin{align*}\n    (-10.64) + (-6.64) + (-6.64) + 13.86 + 5.36 +  21.36  = 16.66 \\\\\n\\end{align*}\\]\n\nWe now have the calculation for the top of our formula, now we use the bottom of the formula and divide the result of the sum by (n-1)\n\n\\[\n\\text= \\frac{16.66}{6-1} = 3.332\n\\]\nWe‚Äôve worked out the variance of two different species across these 6 different fruits, very good going!\nTo make sure we have got it down, lets take the variance of the same bacteria, and as our formula is bacteria * bacteria, we can just do squared.\n¬†\nVariance: Klebsiella vs Klebsiella \\[\\begin{align*}\n&Apricot:(13.3)^2 =  176.89 \\\\\n&Argan:(8.3)^2 = 68.89 \\\\\n&Grapefruit:(8.3)^2 = 68.89 \\\\\n&Orange:(3.3)^2 = 10.89 \\\\\n&Peach:(-6.7)^2 = 44.89 \\\\\n&Tangerine:(-26.7)^2 = 712.89 \\\\\n\\end{align*}\\]\n¬†\\[\\begin{align*}\n    176.89 + 68.89 + 68.89 + 10.89 + 44.89 + 712.89\n    = 1083.34 \\\\\n\\end{align*}\\]\n\\[\n\\frac{1083.34}{6-1} = 216.668\n\\]\nWe have manually worked out that the covariance matrix of (Klebsiella, Acinetobacter) = 3.332 and the covariance matrix of (Klebsiella, Klebsiella) = 216.668.\nNow we know how to work out covariance matrices manually, we can be pleased with ourselves, and just use R to work out the rest‚Ä¶ This is how to do that!\n\n\n3.2 Using R to work out the covariance matrix values\nWe first put our centered data in a matrix for R to read:\n\ncentered_data &lt;- data.frame(\n  Klebsiella = c(13.3, 8.3, 8.3, 3.3, -6.7, -26.7),\n  Acinetobacter = c(-0.8, -0.8, -0.8, 4.2, -0.8, -0.8),\n  Pantoea = c(-7.5, -2.5, -2.5, -2.5, 2.5, 12.5),\n  Pseudoxanthomonas = c(-7.5, -2.5, -2.5, -2.5, 2.5, 12.5),\n  Serratia = c(-3.3, -3.3, -3.3, 1.7, 1.7, 6.7),\n  Stenotrophomonas = c(-1.7, -1.7, -1.7, -1.7, 3.3, 3.3),\n  Delftia = c(0, 0, 0, 0, 0, 0),\n  Burkholderia = c(-0.8, -0.8, -0.8, -0.8, -0.8, 4.2),\n  Sphingomonas = c(-2.5, -2.5, -2.5, -2.5, 2.5, 7.5),\n  Bacillus = c(-0.8, -0.8, -0.8, -0.8, 4.2, -0.8),\n  Sphingobacterium = c(-1.7, 3.3, 3.3, -1.7, -1.7, -1.0),\n  Mycoplasma = c(1.7, 1.7, 1.7, 1.7, -3.3, -3.3))\n\ncentered_data_matrix &lt;- as.matrix(centered_data)\n\n\nShow/Hide Centered Data Matrix\n\n\n\n\n     Klebsiella Acinetobacter Pantoea Pseudoxanthomonas Serratia\n[1,]       13.3          -0.8    -7.5              -7.5     -3.3\n[2,]        8.3          -0.8    -2.5              -2.5     -3.3\n[3,]        8.3          -0.8    -2.5              -2.5     -3.3\n[4,]        3.3           4.2    -2.5              -2.5      1.7\n[5,]       -6.7          -0.8     2.5               2.5      1.7\n[6,]      -26.7          -0.8    12.5              12.5      6.7\n     Stenotrophomonas Delftia Burkholderia Sphingomonas Bacillus\n[1,]             -1.7       0         -0.8         -2.5     -0.8\n[2,]             -1.7       0         -0.8         -2.5     -0.8\n[3,]             -1.7       0         -0.8         -2.5     -0.8\n[4,]             -1.7       0         -0.8         -2.5     -0.8\n[5,]              3.3       0         -0.8          2.5      4.2\n[6,]              3.3       0          4.2          7.5     -0.8\n     Sphingobacterium Mycoplasma\n[1,]             -1.7        1.7\n[2,]              3.3        1.7\n[3,]              3.3        1.7\n[4,]             -1.7        1.7\n[5,]             -1.7       -3.3\n[6,]             -1.0       -3.3\n\n\n\n\n¬†\nNow our centered data is in a matrix, of Fruits x Bacteria, we can use this to work out the covariance matrix. I will show you two different ways to work this out in R.\nBelow shows the code for the actual formula, but written in R.\n\ncov_matrix_1 &lt;- (t(centered_data_matrix) %*% centered_data_matrix) / (nrow(centered_data_matrix) - 1)\n\nt(): this function stands for transpose, meaning we will be flipping the rows and columns. ie: we have fruits as rows, bacteria as columns, but we want to flip this.\n%*%: this is the symbol for how we multiply matrices.\nLike when we calculated it ourselves above, we our multiplying the centered values of the bacteria from one bacteria to another. Then, dividing the total of this across all the fruits by n (the fruits) -1 (the go-to for calculating a sample size).\nLet‚Äôs look at the output from cov_matrix_1:\n\nShow/Hide Manual R cov_matrix_1 Output\n\n\n\n\n                  Klebsiella Acinetobacter Pantoea Pseudoxanthomonas Serratia\nKlebsiella           216.668         3.332 -100.00           -100.00  -56.668\nAcinetobacter          3.332         4.168   -2.50             -2.50    1.668\nPantoea             -100.000        -2.500   47.50             47.50   25.000\nPseudoxanthomonas   -100.000        -2.500   47.50             47.50   25.000\nSerratia             -56.668         1.668   25.00             25.00   16.668\nStenotrophomonas     -33.332        -1.668   15.00             15.00    8.332\nDelftia                0.000         0.000    0.00              0.00    0.000\nBurkholderia         -26.668        -0.832   12.50             12.50    6.668\nSphingomonas         -60.000        -2.500   27.50             27.50   15.000\nBacillus              -6.668        -0.832    2.50              2.50    1.668\nSphingobacterium      12.930        -1.780   -3.25             -3.25   -5.730\nMycoplasma            33.332         1.668  -15.00            -15.00   -8.332\n                  Stenotrophomonas Delftia Burkholderia Sphingomonas Bacillus\nKlebsiella                 -33.332       0      -26.668       -60.00   -6.668\nAcinetobacter               -1.668       0       -0.832        -2.50   -0.832\nPantoea                     15.000       0       12.500        27.50    2.500\nPseudoxanthomonas           15.000       0       12.500        27.50    2.500\nSerratia                     8.332       0        6.668        15.00    1.668\nStenotrophomonas             6.668       0        3.332        10.00    3.332\nDelftia                      0.000       0        0.000         0.00    0.000\nBurkholderia                 3.332       0        4.168         7.50   -0.832\nSphingomonas                10.000       0        7.500        17.50    2.500\nBacillus                     3.332       0       -0.832         2.50    4.168\nSphingobacterium            -2.870       0       -1.080        -3.95   -1.780\nMycoplasma                  -6.668       0       -3.332       -10.00   -3.332\n                  Sphingobacterium Mycoplasma\nKlebsiella                   12.93     33.332\nAcinetobacter                -1.78      1.668\nPantoea                      -3.25    -15.000\nPseudoxanthomonas            -3.25    -15.000\nSerratia                     -5.73     -8.332\nStenotrophomonas             -2.87     -6.668\nDelftia                       0.00      0.000\nBurkholderia                 -1.08     -3.332\nSphingomonas                 -3.95    -10.000\nBacillus                     -1.78     -3.332\nSphingobacterium              6.29      2.870\nMycoplasma                    2.87      6.668\n\n\n\n\n¬†\nGreat, now if you compare the covariance matrix values we calculated earlier, for Klebsiella and Acinetobacter, we calculated 3.332 to be the covariance matrix, and for Klebsiella and Klebsiella - we calculated 216.668, this pretty much matches what R has outputted for us!\n¬† Alternatively, R also has the cov() function, which will work out the covariance matrix for you.\n\ncov_matrix_R &lt;- cov(centered_data_matrix)\n\n\nShow/Hide R Function cov_matrix_R Output\n\n\n\n\n                   Klebsiella Acinetobacter Pantoea Pseudoxanthomonas\nKlebsiella         216.666667     3.3333333 -100.00           -100.00\nAcinetobacter        3.333333     4.1666667   -2.50             -2.50\nPantoea           -100.000000    -2.5000000   47.50             47.50\nPseudoxanthomonas -100.000000    -2.5000000   47.50             47.50\nSerratia           -56.666667     1.6666667   25.00             25.00\nStenotrophomonas   -33.333333    -1.6666667   15.00             15.00\nDelftia              0.000000     0.0000000    0.00              0.00\nBurkholderia       -26.666667    -0.8333333   12.50             12.50\nSphingomonas       -60.000000    -2.5000000   27.50             27.50\nBacillus            -6.666667    -0.8333333    2.50              2.50\nSphingobacterium    12.933333    -1.7833333   -3.25             -3.25\nMycoplasma          33.333333     1.6666667  -15.00            -15.00\n                    Serratia Stenotrophomonas Delftia Burkholderia Sphingomonas\nKlebsiella        -56.666667       -33.333333       0  -26.6666667       -60.00\nAcinetobacter       1.666667        -1.666667       0   -0.8333333        -2.50\nPantoea            25.000000        15.000000       0   12.5000000        27.50\nPseudoxanthomonas  25.000000        15.000000       0   12.5000000        27.50\nSerratia           16.666667         8.333333       0    6.6666667        15.00\nStenotrophomonas    8.333333         6.666667       0    3.3333333        10.00\nDelftia             0.000000         0.000000       0    0.0000000         0.00\nBurkholderia        6.666667         3.333333       0    4.1666667         7.50\nSphingomonas       15.000000        10.000000       0    7.5000000        17.50\nBacillus            1.666667         3.333333       0   -0.8333333         2.50\nSphingobacterium   -5.733333        -2.866667       0   -1.0833333        -3.95\nMycoplasma         -8.333333        -6.666667       0   -3.3333333       -10.00\n                    Bacillus Sphingobacterium Mycoplasma\nKlebsiella        -6.6666667        12.933333  33.333333\nAcinetobacter     -0.8333333        -1.783333   1.666667\nPantoea            2.5000000        -3.250000 -15.000000\nPseudoxanthomonas  2.5000000        -3.250000 -15.000000\nSerratia           1.6666667        -5.733333  -8.333333\nStenotrophomonas   3.3333333        -2.866667  -6.666667\nDelftia            0.0000000         0.000000   0.000000\nBurkholderia      -0.8333333        -1.083333  -3.333333\nSphingomonas       2.5000000        -3.950000 -10.000000\nBacillus           4.1666667        -1.783333  -3.333333\nSphingobacterium  -1.7833333         6.281667   2.866667\nMycoplasma        -3.3333333         2.866667   6.666667\n\n\n\n\n¬†\nAnd again, as you can see from this output, these numbers are very very similar to the ones we calculated! You now know some different ways to calculate the covariance matrix values.\n\n\n\n\n\n\nDeep Dive into PCA\n\n\n\n\n\nWhat do the co-variance matrix values show?\n\nThe co-variance matrix here shows how these bacterial species vary together across different fruits. Positive values mean they move in the same direction, negative values mean when one increases, the other tends to decrease. For example lets look at our outputs and focus on Klebsiella. Klebsiella and Acinetobacter move together (3.33), while Klebsiella and Pantonea move in opposite directions (-100).\n\n\n\n¬†\n¬†\n\n\n\nStep 4: Generating eigenvalues and eigenvectors.\nOnce we have the covariance matrices, we can proceed with the next step of PCA calculations by calculating the eigenvalues and eigenvectors! As discussed earlier;\n\nThe eigenvalues represent the amount of variance in each principal component\nThe eigenvectors represent the direction of principal components.\n\n\n\n\n\n\nThis image was generated from ChatGPT.\n\n\n\n\nHowever, the maths to calculate the eigenvalues and eigenvectors is VERY VERY complicated, so for now, we are just going to use R‚Ä¶\nIf the maths is something you are keen to know to know, this page by Ken Kuttler might help.\nDespite this, it‚Äôs probably still sensible to understand a little more how eigenvalues and eigenvectors work. This leads us to something called spectral theory: a branch of mathematics that studies the spectrum of a matrix or operator, including its eigenvalues and eigenvectors. Spectral theory helps us understand how a matrix behaves by analysing these components, offering deep insights into the structure and transformations represented by the matrix.\nWe can calculate these using the eigen() function in R, which will output both the values and the vectors.\n\neigen &lt;- eigen(cov_matrix_R)\n\n\nShow/Hide Eigen Output\n\n\n\n\neigen() decomposition\n$values\n [1]  3.552576e+02  1.107888e+01  8.617986e+00  2.993896e+00  7.849813e-15\n [6]  1.289621e-15  5.405335e-16  3.633270e-17  9.287314e-32 -2.102773e-16\n[11] -1.365406e-15 -3.018445e-14\n$vectors\n             [,1]        [,2]        [,3]        [,4]         [,5]\n [1,]  0.78063519  0.09246510 -0.09110918  0.05643682  0.442049227\n [2,]  0.01435545 -0.31761481  0.51438923  0.48199530  0.328877551\n [3,] -0.36171417  0.28573974  0.01592520  0.19373557  0.001375333\n [4,] -0.36171417  0.28573974  0.01592520  0.19373557  0.344916440\n [5,] -0.20228279 -0.34790983  0.29478661  0.11591146  0.208929130\n [6,] -0.12071823 -0.15461907 -0.37585160  0.04924008  0.088644405\n [7,]  0.00000000  0.00000000  0.00000000  0.00000000  0.000000000\n [8,] -0.09592001  0.12432406  0.15624898 -0.41532392  0.143367861\n [9,] -0.21663824 -0.03029501 -0.21960262 -0.36608385  0.698426108\n[10,] -0.02479821 -0.27894314 -0.53210057  0.46456400 -0.011484218\n[11,]  0.04377806  0.68134994 -0.03738393  0.38576261  0.095757454\n[12,]  0.12071823  0.15461907  0.37585160 -0.04924008 -0.091097936\n               [,6]          [,7]          [,8]          [,9]         [,10]\n [1,]  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00\n [2,] -1.273819e-01 -6.464465e-02  3.998530e-02 -2.713994e-16 -4.784163e-02\n [3,] -4.998453e-01 -5.439577e-02  3.006026e-01 -1.442308e-15 -2.154630e-01\n [4,]  5.956601e-01  4.090559e-01 -1.610771e-01  1.175142e-15  1.341670e-01\n [5,]  3.156701e-02 -2.900155e-01 -1.795108e-01  5.385656e-16  1.291376e-01\n [6,]  1.908142e-01 -4.443074e-01 -4.299966e-01 -4.525482e-15 -5.815663e-01\n [7,] -9.803617e-16  5.217727e-17 -1.782932e-15  1.000000e+00 -6.518782e-15\n [8,] -3.687018e-01 -6.606470e-02 -6.204302e-01  1.370891e-15  3.789069e-01\n [9,] -2.039325e-01  1.040540e-01  2.662426e-01 -1.019423e-15 -1.727683e-01\n[10,] -3.628517e-01  4.076416e-01 -2.741809e-01  3.931050e-16  1.840657e-01\n[11,] -9.581485e-02 -3.546601e-01 -1.395255e-01  2.671662e-16  8.129596e-02\n[12,] -1.527733e-01  4.866930e-01 -3.383947e-01 -5.147566e-15 -6.037232e-01\n           [,11]       [,12]\n [1,]  0.0000000 -0.41852765\n [2,]  0.4511154  0.25698386\n [3,]  0.1227363 -0.58742834\n [4,]  0.1193344 -0.22457995\n [5,] -0.6931861 -0.28203086\n [6,]  0.2169611 -0.07723764\n [7,]  0.0000000  0.00000000\n [8,]  0.2845431 -0.09003593\n [9,] -0.1520000  0.32535310\n[10,] -0.1103916  0.05846761\n[11,] -0.2420706  0.39348064\n[12,] -0.2544753  0.07464622\n\n\n\n\n¬†\nThis will output both eigenvalues and eigenvectors. Alternatively, we can look at the value and vectors individually, for the purpose of calculating our principal components for this analysis lets do this, and go through what each eigen is showing.\nThe eigenvalues:\n\neigen_values &lt;- eigen$values\n\n\nShow/Hide Eigen Values Output\n\n\n\n\n [1]  3.552576e+02  1.107888e+01  8.617986e+00  2.993896e+00  7.849813e-15\n [6]  1.289621e-15  5.405335e-16  3.633270e-17  9.287314e-32 -2.102773e-16\n[11] -1.365406e-15 -3.018445e-14\n\n\n\n\n¬†\nR has given us 12 eigenvalues because our dataset includes 12 different bacteria types, meaning the covariance matrix is 12√ó12. Each eigenvalue corresponds to a principal component and tells us how much variance in the data that component explains. As we can see, the first few eigenvalues are large, capturing most of the variation, while the later ones are extremely small ‚Äî close to zero ‚Äî and can be ignored. This means we can reduce the dimensionality of our data by focusing on just the components with the largest eigenvalues - we will go more into this later.\n¬†\nThe eigenvectors:\n\neigen_vectors &lt;- eigen$vectors\n\n\nShow/Hide Eigen Vectors Output\n\n\n\n\n             [,1]        [,2]        [,3]        [,4]         [,5]\n [1,]  0.78063519  0.09246510 -0.09110918  0.05643682  0.442049227\n [2,]  0.01435545 -0.31761481  0.51438923  0.48199530  0.328877551\n [3,] -0.36171417  0.28573974  0.01592520  0.19373557  0.001375333\n [4,] -0.36171417  0.28573974  0.01592520  0.19373557  0.344916440\n [5,] -0.20228279 -0.34790983  0.29478661  0.11591146  0.208929130\n [6,] -0.12071823 -0.15461907 -0.37585160  0.04924008  0.088644405\n [7,]  0.00000000  0.00000000  0.00000000  0.00000000  0.000000000\n [8,] -0.09592001  0.12432406  0.15624898 -0.41532392  0.143367861\n [9,] -0.21663824 -0.03029501 -0.21960262 -0.36608385  0.698426108\n[10,] -0.02479821 -0.27894314 -0.53210057  0.46456400 -0.011484218\n[11,]  0.04377806  0.68134994 -0.03738393  0.38576261  0.095757454\n[12,]  0.12071823  0.15461907  0.37585160 -0.04924008 -0.091097936\n               [,6]          [,7]          [,8]          [,9]         [,10]\n [1,]  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00\n [2,] -1.273819e-01 -6.464465e-02  3.998530e-02 -2.713994e-16 -4.784163e-02\n [3,] -4.998453e-01 -5.439577e-02  3.006026e-01 -1.442308e-15 -2.154630e-01\n [4,]  5.956601e-01  4.090559e-01 -1.610771e-01  1.175142e-15  1.341670e-01\n [5,]  3.156701e-02 -2.900155e-01 -1.795108e-01  5.385656e-16  1.291376e-01\n [6,]  1.908142e-01 -4.443074e-01 -4.299966e-01 -4.525482e-15 -5.815663e-01\n [7,] -9.803617e-16  5.217727e-17 -1.782932e-15  1.000000e+00 -6.518782e-15\n [8,] -3.687018e-01 -6.606470e-02 -6.204302e-01  1.370891e-15  3.789069e-01\n [9,] -2.039325e-01  1.040540e-01  2.662426e-01 -1.019423e-15 -1.727683e-01\n[10,] -3.628517e-01  4.076416e-01 -2.741809e-01  3.931050e-16  1.840657e-01\n[11,] -9.581485e-02 -3.546601e-01 -1.395255e-01  2.671662e-16  8.129596e-02\n[12,] -1.527733e-01  4.866930e-01 -3.383947e-01 -5.147566e-15 -6.037232e-01\n           [,11]       [,12]\n [1,]  0.0000000 -0.41852765\n [2,]  0.4511154  0.25698386\n [3,]  0.1227363 -0.58742834\n [4,]  0.1193344 -0.22457995\n [5,] -0.6931861 -0.28203086\n [6,]  0.2169611 -0.07723764\n [7,]  0.0000000  0.00000000\n [8,]  0.2845431 -0.09003593\n [9,] -0.1520000  0.32535310\n[10,] -0.1103916  0.05846761\n[11,] -0.2420706  0.39348064\n[12,] -0.2544753  0.07464622\n\n\n\n\n¬†\nThe eigenvectors are set out the same sort of way as our co-variance matrix, in the order of Klebsiella, Acinetobacter and Pantonea. For example, the first eigenvalue shows 0.78063519 for Klebsiella v Klebsiella, the lack of negative value means it is in the opposite direction to Klebsiella and Pantonea, which has a negative value (-0.09110918).\n¬†\n\n\nStep 5: Calculate the Principal Components\nNow we have found the eigenvalues and eigenvectors we work out the principal components! Let‚Äôs make sure to go through this step by step.\n¬†\n5.1 We first need to take the centered data matrix we made earlier\ncentered_data_matrix\n¬†\n5.2 We then need to work out the eigenvectors from the covariance matrix (we made the eigenvectors from our centered data):\n\neigen &lt;- eigen(cov_matrix_R)\neigen_vectors &lt;- eigen$vectors\n\n¬†\n5.3 We choose what eigenvalues we are using\nOnly the first 4 principal components are actually positive values, principal components 5-12 are negative values, so we can in theory ignore these, and take the first four for now.\n\neigen_values &lt;- eigen$values[1:4]\neigen_values\n\n[1] 355.257570  11.078881   8.617986   2.993896\n\n\n¬†\n5.4 We calculate the actual PC components\nWe know that the eigenvectors represent the direction of the principal components, so we first calculate our principal components, based on our centered data, and our eigenvectors, by using the matrix multiplication.\n\nnew_data &lt;- centered_data_matrix %*% eigen_vectors\n\n\nFruit &lt;- c(\"Apricot\", \"Argan\", \"Grapefruit\", \"Orange\", \"Peach\", \"Tangerine\")\n\nPCA_values &lt;- data.frame(\n  Fruit = Fruit,\n  PC1 = new_data[, 1],\n  PC2 = new_data[, 2])\n\n \nPCA_values\n\n       Fruit        PC1       PC2\n1    Apricot  17.438399 -2.087273\n2      Argan  10.136971  3.714548\n3 Grapefruit  10.136971  3.714548\n4     Orange   5.075269 -3.482150\n5      Peach  -8.834367 -3.053711\n6  Tangerine -34.100923  1.414038\n\n\n¬†\n5.5 Generating the PCA plot.\nBut before we do this, earlier I mentioned that we will go back to the eigen values - this is for now. We took four as they were all positive values, but choosing components is usually based on what explains most of the variance, so we will be fine taking the first two. As they make up for the vast majority of the variance.\n\neigen_values &lt;- eigen_values[1:2]\n\nPCA_variance &lt;- round(100 * eigen_values / sum(eigen_values), 2)\n\nUsing these 2 PCA values, we can get away with generating just the one PCA plot; this is PCA 1 vs.¬†PCA 2.\n\nlibrary(ggplot2)\n\npca_plot &lt;- ggplot(PCA_values, aes(x = PC1, y = PC2, color = Fruit)) +\n  geom_point(size = 4) +\n  geom_text(aes(label = Fruit), vjust = -1, hjust = 1.2, size = 3, show.legend = FALSE) +\n  labs(\n    title = \"PCA of Fruit Samples\",\n    x = paste0(\"Principal Component 1 (\", PCA_variance[1], \"%)\"),\n    y = paste0(\"Principal Component 2 (\", PCA_variance[2], \"%)\")\n  ) +\n  theme_minimal() +\n  theme(\n    plot.margin = margin(20, 20, 20, 20),\n    plot.title = element_text(hjust = 0.5)\n  ) +\n  scale_color_brewer(palette = \"Dark2\")\n\n¬†\nNow let‚Äôs see this beautiful plot all together! ¬†\n\n\n\n\n\n¬† What can we see? ¬†\nThis PCA plot shows variation among different fruit samples based on their principal components. Samples like Orange and Peach cluster closely together, indicating similar microbiome compositions, while Apricot and Argan are positioned farther apart, meaning Medfly reared on these fruits may have greater differences. Grapefruit stands out as more distinct from the other samples. Overall, the plot shows clear groupings and separation among the Medfly microbiotas based on the fruits they were reared on. You can check this against the data shown at the beginning of this page!\n¬†\n¬†\nTo summarise this chapter, we have taken a deep dive into PCA, and hopefully what actually it is."
  },
  {
    "objectID": "qmds/PCA.html#pca---test-yourself",
    "href": "qmds/PCA.html#pca---test-yourself",
    "title": "Principal Component Analysis (PCA)",
    "section": "PCA - Test Yourself!",
    "text": "PCA - Test Yourself!\nThat probably felt like a lot, and well done for getting through!\n\nWhat are the six key steps of PCA you were introduced to?\n\n\n A. 1. Center the data, 2. Scale the data, 3. Calculate the covariance matrix values, 4. Calculate the eigenvalues and eigenvectors, 5. Calculate the principal component spaces, 6. Generate the PCA plot with these   B. 1. Normalize the data, 2. Perform clustering, 3. Compute distances, 4. Generate a heatmap, 5. Sort by similarity, 6. Interpret clusters visually  C. 1. One-hot encode variables, 2. Apply k-means clustering, 3. Compute centroids, 4. Evaluate silhouette scores, 5. Merge similar groups, 6. Visualize group centroids  D. 1. Calculate correlation matrix, 2. Remove outliers, 3. Build decision trees, 4. Rank variable importance, 5. Apply bootstrapping, 6. Use top features in model\n\nSubmit\n\n\n\n\n\n\n\nWhy do we center the data?\n\n\n A. To ensure eigenvalues are always positive  B. To convert the data into binary form for easier computation  C. To ensure that each feature has a mean of zero, allowing PCA to correctly find directions of maximum variance  D. To standardize the range of each variable to between 0 and 1\n\nSubmit\n\n\n\n\n\n\n\nIn PCA, what do the eigenvalues and eigenvectors of the covariance matrix represent?\n\n\n A. Eigenvalues determine the correlation between original variables; eigenvectors show how to cluster them  B. Eigenvalues represent the amount of variance captured by each principal component; eigenvectors define the direction of these components  C. Eigenvalues are used to normalize the data; eigenvectors eliminate redundancy  D. Eigenvalues and eigenvectors sort features in descending order of importance based on their original units\n\nSubmit"
  },
  {
    "objectID": "qmds/PCA.html#a-background-to-principal-component-analysis",
    "href": "qmds/PCA.html#a-background-to-principal-component-analysis",
    "title": "Principal Component Analysis (PCA)",
    "section": "A background to Principal Component Analysis:",
    "text": "A background to Principal Component Analysis:\n\nAn overview of Principal Component Analysis:\nPrincipal Component Analysis (PCA) is a widely used data visualisation and dimensionality-reduction technique that helps simplify complex datasets containing many variables. Instead of analysing each variable independently, PCA summarises the data into a small number of principal components that capture the most important patterns of variation.\nWhen visualised in a PCA plot, each point represents a sample. Samples that appear close together are more similar in composition, while those farther apart are more different. Take the example shown below, the horse and zebra are close together, and the chicken and turkey are also close together! This makes PCA particularly useful for exploring structure, grouping, and trends in large biological datasets, such as microbial community data.\nPCA performs best when relationships between variables are approximately linear, as it identifies directions in the data that explain variation along straight-line axes.\n\n\n\n\n\nCredit: This image was created on Canva.\n\n\n\n\n\n\nHow Principal Component Analysis measures similarity:\nThe similarity between samples in a PCA plot is typically based on Euclidean distance, which measures the straight-line distance between points in the reduced-dimensional space. PCA is designed so that this reduced space retains as much of the original variation as possible, meaning that distances between samples remain biologically and statistically meaningful.\n\n\nBreaking Principal Component Analysis down into key concepts:\n\nDimensionality reduction: PCA reduces datasets with many variables into a smaller number of uncorrelated components, combining information from highly correlated variables.\nData centring and scaling: Before PCA is performed, data are usually centred so that each variable has a mean of zero. In many biological datasets, data are also scaled to account for differences in measurement units or variance between variables.\nCovariance matrix: PCA calculates a covariance matrix from the centred data. This matrix describes how pairs of variables vary together and allows PCA to detect patterns of correlation and redundancy within the dataset.\nEigen decomposition: The covariance matrix is decomposed into eigenvalues and eigenvectors: Eigenvalues indicate how much of the total variance is explained by each principal component. Eigenvectors define the direction of each component in multivariate space and show how strongly each original variable contributes.\nOne way you can remember the difference of these is; (i) the direction of the arrow is the eigenvector, and (i) the length of the arrow is the eigenvalue.\nRanking principal components: Principal components are ranked by their eigenvalues. The first principal component (PC1) explains the greatest amount of variation, followed by PC2, PC3, and so on. Typically, only the first few components are retained, based on the proportion of variance explained.\nPrincipal component scores: The retained eigenvectors are used to calculate principal component scores by projecting the centred data onto the new component axes. These scores represent each sample‚Äôs position in the reduced-dimensional space and form the basis of PCA plots used for visualisation and downstream analyses.\n\nKey terms explained:\n\nCentered data: Data where the mean value of each variable has been subtracted, resulting in variables with a mean of zero.\n\n\nCovariance matrix: A matrix that summarises how variables in a dataset change together, highlighting correlations between variables.\n\n\nEigenvalues: Numerical values that represent the amount of variance explained by each principal component.\n\n\nEigenvectors: Directional vectors that define the axes of the principal components and describe variable contributions.\n\n\n\nPCA Step-by-Step:\n\nScale the data (Standardise variables (e.g.¬†bacterial abundances) to ensure they contribute equally.).\nCentre the data (Subtract the column mean of each variable from the dataset.).\nCalculate the covariance matrix values (Use the centred data to quantify relationships between variables.) {style=‚Äúcolor:green‚Äù}.\nCalculate the eigenvalues and eigenvectors with the covariance matrix values.\nCalculate the principal component spaces.\nGenerate the PCA plot.(Visualise patterns, similarities, and differences between samples.).\n\n¬†\n\n\n\n\n\n\nCredit: This image was created on Canva."
  },
  {
    "objectID": "qmds/PCA.html#principal-component-analysis-in-action",
    "href": "qmds/PCA.html#principal-component-analysis-in-action",
    "title": "Principal Component Analysis (PCA)",
    "section": "Principal Component Analysis in action",
    "text": "Principal Component Analysis in action\nNow we know a little bit more about PCA, let‚Äôs use PCA to understand some data using the dataset from Darrington et al. (2022).\nAs mentioned throughout this website, in this study, Medflies were reared on six different fruit types, and their microbiota composition was analysed. So this dataset will allow us to use PCA to visualise how microbiota communities differ depending on the fruit substrate if which the Medflies were reared.\nIf you would like to understand a little more about this study, please see: The Home Page\nTable 1: Relative abundance (%) of bacterial genera on the surfaces of different fruits. Please scroll sideways to see the entire table.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFruit\nKlebsiella\nAcinetobacter\nPantoea\nPseudoxanthomonas\nSerratia\nStenotrophomonas\nDelftia\nBurkholderia\nSphingomonas\nBacillus\nSphingobacterium\nMycoplasma\n\n\n\n\nApricot\n80%\n10%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n\n\nArgan\n75%\n10%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n5%\n\n\nGrapefruit\n75%\n10%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n5%\n\n\nOrange\n70%\n15%\n5%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n\n\nPeach\n60%\n10%\n10%\n10%\n5%\n5%\n0%\n0%\n5%\n5%\n0%\n0%\n\n\nTang\n40%\n10%\n20%\n20%\n10%\n5%\n0%\n5%\n10%\n0%\n0%\n0%\n\n\n\n\n¬†\n\nStep 1: Scaling the data\nOur first step is to scale our data! This involves calculating the mean composition of each bacterial relative abundance across all samples.\nTable 2: Relative abundance (%) of bacterial genera on the surfaces of different fruits. Please scroll sideways to see the entire table.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFruit\nKlebsiella\nAcinetobacter\nPantoea\nPseudoxanthomonas\nSerratia\nStenotrophomonas\nDelftia\nBurkholderia\nSphingomonas\nBacillus\nSphingobacterium\nMycoplasma\n\n\n\n\nApricot\n80%\n10%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n\n\nArgan\n75%\n10%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n5%\n\n\nGF\n75%\n10%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n5%\n\n\nOrange\n70%\n15%\n5%\n5%\n5%\n0%\n0%\n0%\n0%\n0%\n0%\n5%\n\n\nPeach\n60%\n10%\n10%\n10%\n5%\n5%\n0%\n0%\n5%\n5%\n0%\n0%\n\n\nTang\n40%\n10%\n20%\n20%\n10%\n5%\n0%\n5%\n10%\n0%\n0%\n0%\n\n\nMean\n66.7%\n10.8%\n7.5%\n7.5%\n3.3%\n1.7%\n0%\n0.8%\n2.5%\n0.8%\n1.7%\n3.3%\n\n\n\n\n\n\nStep 2: Centering the data\nOur next step is to center the data. We can do this by subtracting the mean composition (which was calculated in Step 1) from each individual value in the data-set. This step adjusts each bacterial taxa so that its average value across all samples becomes zero.\n\n\n\n\n\n\nDeep Dive into Principal Component Analysis\n\n\n\n\n\nWhy do we want the average across the samples to be zero?\n\nPCA is all about variation, not about absolute values. We need to make the average value across zero, so there is no biasing. Say if the abundance of bacteria 1 was 66%, and the bacteria 2 was 5%, if we don‚Äôt center this - PCA may think that bacteria is way more important, just because there is more of it, but PCA is not about this, it‚Äôs all about how bacteria varies and works together with one another.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFruit\nKlebsiella\nAcinetobacter\nPantoea\nPseudoxanthomonas\nSerratia\nStenotrophomonas\nDelftia\nBurkholderia\nSphingomonas\nBacillus\nSphingobacterium\nMycoplasma\n\n\n\n\nApricot\n13.3%\n-0.8%\n-7.5%\n-7.5%\n-3.3%\n-1.7%\n0%\n-0.8%\n-2.5%\n-0.8%\n-1.7%\n1.7%\n\n\nArgan\n8.3%\n-0.8%\n-2.5%\n-2.5%\n-3.3%\n-1.7%\n0%\n-0.8%\n-2.5%\n-0.8%\n3.3%\n1.7%\n\n\nGF\n8.3%\n-0.8%\n-2.5%\n-2.5%\n-3.3%\n-1.7%\n0%\n-0.8%\n-2.5%\n-0.8%\n3.3%\n1.7%\n\n\nOrange\n3.3%\n4.2%\n-2.5%\n-2.5%\n1.7%\n-1.7%\n0%\n-0.8%\n-2.5%\n-0.8%\n-1.7%\n1.7%\n\n\nPeach\n-6.7%\n-0.8%\n2.5%\n2.5%\n1.7%\n3.3%\n0%\n-0.8%\n2.5%\n4.2%\n-1.7%\n-3.3%\n\n\nTang\n-26.7%\n-0.8%\n12.5%\n12.5%\n6.7%\n3.3%\n0%\n4.2%\n7.5%\n-0.8%\n-1.0%\n-3.3%\n\n\n\n\n\n\nStep 3: Calculate the co-variance matrix values\nOnce the data has been mean-centered, we apply the covariance formula to assess the relationships between the bacterial compositions across samples. Covariance measures how much two variables change together.\n\nA positive covariance indicates that both variables increase or decrease together.\nA negative covariance indicates that as one variable increases, the other decreases.\nA covariance close to zero suggests little or no linear relationship.\n\n\nCovariance formulas:\nThe population covariance is defined as:\n\\[\n\\text{Cov}_{\\text{population}} = \\frac{\\sum (x_i - \\bar{x})(y_i - \\bar{y})}{n}\n\\]\nThe sample covariance, typically used for biological analysis is defined as:\n\\[\n\\text{Cov}_{\\text{sample}} = \\frac{\\sum (x_i - \\bar{x})(y_i - \\bar{y})}{n-1}\n\\]\n¬†\nBreaking down the formula\n\\[\n( x_i - \\bar{x} )\n\\] This represents the centred value of variable (x) ‚Äî how far a single measurement (e.g.¬†Klebsiella abundance in one fruit) deviates from the average across all samples.\n\\[\n( y_i - \\bar{y} )\n\\] This represents the centred value of variable (y), such as how Acinetobacter abundance differs from its mean.\n¬†\n\\[\n( n - 1 )\n\\] [This is the total number of samples minus one. We divide by ( n - 1 This is the total number of samples minus one. Dividing by (n - 1) instead of (n) corrects for bias when estimating population variance from a sample ‚Äî a correction known as Bessel‚Äôs correction.\n¬†\n\n\nCalculating the covariance matrix manually:\nUsing the covariance formula and our previously calculated mean-centred data, we can now calculate the values needed to build the covariance matrix.\nAt this stage, we have two options:\n\nJump straight to R, where the covariance matrix can be calculated automatically using built-in functions, or:\nWork through the calculations manually first, to build an intuitive understanding of how covariance values are generated and how PCA works under the hood.\n\nWhile software will always do this step for us in practice, walking through a small example by hand helps clarify what the covariance matrix represents and why it is such a critical component of PCA.\nWe calculate the co-variance matrix using our previously calculated mean-centred data. Let‚Äôs useKlebsiella and Acinetobacter as our example.\nFirst, we take the mean-centred bacterial abundances of Klebsiella and Acinetobacter:\n\n\n\nFruit\nKlebsiella\nAcinetobacter\n\n\n\n\nApricot\n13.3%\n-0.8%\n\n\nArgan\n8.3%\n-0.8%\n\n\nGF\n8.3%\n-0.8%\n\n\nOrange\n3.3%\n4.2%\n\n\nPeach\n-6.7%\n-0.8%\n\n\nTangerine\n-26.7%\n-0.8%\n\n\n\nThese values represent how much each bacterial abundance deviates from its mean across all fruits.\nStep 1: Multiply centered values\nThe numerator of the covariance formula requires us to multiply the centered values of one bacterium by those of the other for each fruit:\nFor example; Apricot: \\[\n( x_i - \\bar{x} ) ( y_i - \\bar{y} ) = ( 13.3 ) ( -0.8 ) = -10.64\n\\]\nRepeating this calculation for all fruits:\n\\[\\begin{align*}\n&Apricot:(13.3)*(-0.8) = -10.64 \\\\\n&Argan:(8.3)*(-0.8) = -6.64 \\\\\n&Grapefruit:(8.3)*(-0.8) = -6.64 \\\\\n&Orange:(3.3)*(4.2) = 13.86 \\\\\n&Peach:(-6.7)*(-0.8) = 5.36 \\\\\n&Tangerine:(-26.7)*(-0.8) =  21.36 \\\\\n\\end{align*}\\]\nStep 2: Sum the products\n\\[\\begin{align*}\n    (-10.64) + (-6.64) + (-6.64) + 13.86 + 5.36 +  21.36  = 16.66 \\\\\n\\end{align*}\\]\nStep 3: Divide by n - 1 Because this is a sample covariance, we divide by n - 1, where n=6 fruits: \\[\n\\text= \\frac{16.66}{6-1} = 3.332\n\\]\nThis positive covariance suggests that Klebsiella and Acinetobacter tend to vary together across fruit hosts, although the strength of this relationship is relatively modest.\nChecking our understanding - Klebsiella vs Klebsiella :\nTo reinforce the concept, let‚Äôs take another example. This time, let‚Äôs calculate the variance of a single bacterium (Klebsiella). In this instance, variance is simply covariance of a variable with itself, meaning we square the centred values.\nVariance: Klebsiella vs Klebsiella \\[\\begin{align*}\n&Apricot:(13.3)^2 =  176.89 \\\\\n&Argan:(8.3)^2 = 68.89 \\\\\n&Grapefruit:(8.3)^2 = 68.89 \\\\\n&Orange:(3.3)^2 = 10.89 \\\\\n&Peach:(-6.7)^2 = 44.89 \\\\\n&Tangerine:(-26.7)^2 = 712.89 \\\\\n\\end{align*}\\]\n¬†\\[\\begin{align*}\n    176.89 + 68.89 + 68.89 + 10.89 + 44.89 + 712.89\n    = 1083.34 \\\\\n\\end{align*}\\]\n\\[\n\\frac{1083.34}{6-1} = 216.668\n\\]\nHere, the covariance matrix value for (Klebsiella, Klebsiella) is 216.668. This represents the variance of Klebsiella across the fruit samples, indicating that Klebsiella abundance varies substantially between the samples. In contrast, the much lower covariance value for (Klebsiella, Acinetobacter) shows how the abundances of these two taxa vary together across samples, so it makes sense that this is lower.\nNow that we have actually calculated two examples of the covariance matrix values manually, we can be more confident that we understand the concepts, and we can use R code to work out the rest.\n\n\nUsing R to calculate covariance matrix values\nIn using R to calculate the covariance matrix values. We first put our centered abundance data into a matrix so that R can compute the covariance matrix.\n\ncentered_data &lt;- data.frame(\n  Klebsiella = c(13.3, 8.3, 8.3, 3.3, -6.7, -26.7),\n  Acinetobacter = c(-0.8, -0.8, -0.8, 4.2, -0.8, -0.8),\n  Pantoea = c(-7.5, -2.5, -2.5, -2.5, 2.5, 12.5),\n  Pseudoxanthomonas = c(-7.5, -2.5, -2.5, -2.5, 2.5, 12.5),\n  Serratia = c(-3.3, -3.3, -3.3, 1.7, 1.7, 6.7),\n  Stenotrophomonas = c(-1.7, -1.7, -1.7, -1.7, 3.3, 3.3),\n  Delftia = c(0, 0, 0, 0, 0, 0),\n  Burkholderia = c(-0.8, -0.8, -0.8, -0.8, -0.8, 4.2),\n  Sphingomonas = c(-2.5, -2.5, -2.5, -2.5, 2.5, 7.5),\n  Bacillus = c(-0.8, -0.8, -0.8, -0.8, 4.2, -0.8),\n  Sphingobacterium = c(-1.7, 3.3, 3.3, -1.7, -1.7, -1.0),\n  Mycoplasma = c(1.7, 1.7, 1.7, 1.7, -3.3, -3.3))\n\ncentered_data_matrix &lt;- as.matrix(centered_data)\n\nThe column of 1-6 shows the different fruit, in the order of Apricot, Argan, Grapefruit, Orange, Peach and Tangerine.\n\nShow/Hide centered_data_matrix &lt;- as.matrix(centered_data) output\n\n\n\n\n     Klebsiella Acinetobacter Pantoea Pseudoxanthomonas Serratia\n[1,]       13.3          -0.8    -7.5              -7.5     -3.3\n[2,]        8.3          -0.8    -2.5              -2.5     -3.3\n[3,]        8.3          -0.8    -2.5              -2.5     -3.3\n[4,]        3.3           4.2    -2.5              -2.5      1.7\n[5,]       -6.7          -0.8     2.5               2.5      1.7\n[6,]      -26.7          -0.8    12.5              12.5      6.7\n     Stenotrophomonas Delftia Burkholderia Sphingomonas Bacillus\n[1,]             -1.7       0         -0.8         -2.5     -0.8\n[2,]             -1.7       0         -0.8         -2.5     -0.8\n[3,]             -1.7       0         -0.8         -2.5     -0.8\n[4,]             -1.7       0         -0.8         -2.5     -0.8\n[5,]              3.3       0         -0.8          2.5      4.2\n[6,]              3.3       0          4.2          7.5     -0.8\n     Sphingobacterium Mycoplasma\n[1,]             -1.7        1.7\n[2,]              3.3        1.7\n[3,]              3.3        1.7\n[4,]             -1.7        1.7\n[5,]             -1.7       -3.3\n[6,]             -1.0       -3.3\n\n\n\n\nNow our centered data is in a matrix, of Fruits x Bacteria (an important step), we can use this to work out the covariance matrix.\nThere are two different ways this can be calculated in R, I will show you:\nBelow shows the code for the actual formula, but written in R:\n\ncov_matrix_1 &lt;- (t(centered_data_matrix) %*% centered_data_matrix) / (nrow(centered_data_matrix) - 1)\n\nt(): this function stands for transpose, meaning we will be flipping the rows and columns. ie: we have fruits as rows, bacteria as columns, but we want to flip this.\n%*%: this is the symbol for how we multiply matrices.\nLike when we calculated it ourselves above, we our multiplying the centered values of the bacteria from one bacteria to another. Then, dividing the total of this across all the fruits by n (the fruits) -1 (the go-to for calculating a sample size).\n(nrow(centered_data_matrix) - 1): This is the degrees of freedom correction used in the sample covariance. We use the number of fruits, - 1.\nLet‚Äôs look at the output from cov_matrix_1:\n\nShow/Hide Manual R cov_matrix_1 output\n\n\n\n\n                  Klebsiella Acinetobacter Pantoea Pseudoxanthomonas Serratia\nKlebsiella           216.668         3.332 -100.00           -100.00  -56.668\nAcinetobacter          3.332         4.168   -2.50             -2.50    1.668\nPantoea             -100.000        -2.500   47.50             47.50   25.000\nPseudoxanthomonas   -100.000        -2.500   47.50             47.50   25.000\nSerratia             -56.668         1.668   25.00             25.00   16.668\nStenotrophomonas     -33.332        -1.668   15.00             15.00    8.332\nDelftia                0.000         0.000    0.00              0.00    0.000\nBurkholderia         -26.668        -0.832   12.50             12.50    6.668\nSphingomonas         -60.000        -2.500   27.50             27.50   15.000\nBacillus              -6.668        -0.832    2.50              2.50    1.668\nSphingobacterium      12.930        -1.780   -3.25             -3.25   -5.730\nMycoplasma            33.332         1.668  -15.00            -15.00   -8.332\n                  Stenotrophomonas Delftia Burkholderia Sphingomonas Bacillus\nKlebsiella                 -33.332       0      -26.668       -60.00   -6.668\nAcinetobacter               -1.668       0       -0.832        -2.50   -0.832\nPantoea                     15.000       0       12.500        27.50    2.500\nPseudoxanthomonas           15.000       0       12.500        27.50    2.500\nSerratia                     8.332       0        6.668        15.00    1.668\nStenotrophomonas             6.668       0        3.332        10.00    3.332\nDelftia                      0.000       0        0.000         0.00    0.000\nBurkholderia                 3.332       0        4.168         7.50   -0.832\nSphingomonas                10.000       0        7.500        17.50    2.500\nBacillus                     3.332       0       -0.832         2.50    4.168\nSphingobacterium            -2.870       0       -1.080        -3.95   -1.780\nMycoplasma                  -6.668       0       -3.332       -10.00   -3.332\n                  Sphingobacterium Mycoplasma\nKlebsiella                   12.93     33.332\nAcinetobacter                -1.78      1.668\nPantoea                      -3.25    -15.000\nPseudoxanthomonas            -3.25    -15.000\nSerratia                     -5.73     -8.332\nStenotrophomonas             -2.87     -6.668\nDelftia                       0.00      0.000\nBurkholderia                 -1.08     -3.332\nSphingomonas                 -3.95    -10.000\nBacillus                     -1.78     -3.332\nSphingobacterium              6.29      2.870\nMycoplasma                    2.87      6.668\n\n\n\n\nWe have now generated all the covariance matrix values. Let‚Äôs check some of these results against what we calculated earlier. For Klebsiella and Acinetobacter, we calculated 3.332 to be the covariance matrix, and for Klebsiella and Klebsiella - we calculated 216.668. Looking at what R has output for us, this pretty much matches up!\nIf you want to make it even easier, R also has the cov() function, which will work out the covariance matrix for you. You simply need to put in your centered data matrix.\n\ncov_matrix_R &lt;- cov(centered_data_matrix)\n\n\nShow/Hide R Function cov_matrix_R output\n\n\n\n\n                   Klebsiella Acinetobacter Pantoea Pseudoxanthomonas\nKlebsiella         216.666667     3.3333333 -100.00           -100.00\nAcinetobacter        3.333333     4.1666667   -2.50             -2.50\nPantoea           -100.000000    -2.5000000   47.50             47.50\nPseudoxanthomonas -100.000000    -2.5000000   47.50             47.50\nSerratia           -56.666667     1.6666667   25.00             25.00\nStenotrophomonas   -33.333333    -1.6666667   15.00             15.00\nDelftia              0.000000     0.0000000    0.00              0.00\nBurkholderia       -26.666667    -0.8333333   12.50             12.50\nSphingomonas       -60.000000    -2.5000000   27.50             27.50\nBacillus            -6.666667    -0.8333333    2.50              2.50\nSphingobacterium    12.933333    -1.7833333   -3.25             -3.25\nMycoplasma          33.333333     1.6666667  -15.00            -15.00\n                    Serratia Stenotrophomonas Delftia Burkholderia Sphingomonas\nKlebsiella        -56.666667       -33.333333       0  -26.6666667       -60.00\nAcinetobacter       1.666667        -1.666667       0   -0.8333333        -2.50\nPantoea            25.000000        15.000000       0   12.5000000        27.50\nPseudoxanthomonas  25.000000        15.000000       0   12.5000000        27.50\nSerratia           16.666667         8.333333       0    6.6666667        15.00\nStenotrophomonas    8.333333         6.666667       0    3.3333333        10.00\nDelftia             0.000000         0.000000       0    0.0000000         0.00\nBurkholderia        6.666667         3.333333       0    4.1666667         7.50\nSphingomonas       15.000000        10.000000       0    7.5000000        17.50\nBacillus            1.666667         3.333333       0   -0.8333333         2.50\nSphingobacterium   -5.733333        -2.866667       0   -1.0833333        -3.95\nMycoplasma         -8.333333        -6.666667       0   -3.3333333       -10.00\n                    Bacillus Sphingobacterium Mycoplasma\nKlebsiella        -6.6666667        12.933333  33.333333\nAcinetobacter     -0.8333333        -1.783333   1.666667\nPantoea            2.5000000        -3.250000 -15.000000\nPseudoxanthomonas  2.5000000        -3.250000 -15.000000\nSerratia           1.6666667        -5.733333  -8.333333\nStenotrophomonas   3.3333333        -2.866667  -6.666667\nDelftia            0.0000000         0.000000   0.000000\nBurkholderia      -0.8333333        -1.083333  -3.333333\nSphingomonas       2.5000000        -3.950000 -10.000000\nBacillus           4.1666667        -1.783333  -3.333333\nSphingobacterium  -1.7833333         6.281667   2.866667\nMycoplasma        -3.3333333         2.866667   6.666667\n\n\n\n\nAgain, the numbers shown are the covariance matrix values. If we compare these with our manually calculated ones too, you can see these are also very similar!\n\n\n\n\n\n\nDeep Dive into PCA\n\n\n\n\n\nWhat do the co-variance matrix values show?\n\nThe co-variance matrix here shows how these bacterial species vary together across different fruits. Positive values mean they move in the same direction, negative values mean when one increases, the other tends to decrease. For example lets look at our outputs and focus on Klebsiella. Klebsiella and Acinetobacter move together (3.33), while Klebsiella and Pantonea move in opposite directions (-100).\n\n\n\n¬†\n¬†\n\n\n\nStep 4: Generating eigenvalues and eigenvectors.\nOnce we have the covariance matrices, we can proceed with the next step of PCA calculations by calculating the eigenvalues and eigenvectors! As discussed earlier:\n\nThe eigenvalues represent the amount of variance in each principal component\nThe eigenvectors represent the direction of principal components.\n\n\n\n\n\n\nThis image was generated from ChatGPT.\n\n\n\n\nThe maths to calculate the eigenvalues and eigenvectors is quite complicated, so for now, we are just going to use R. If the maths is something you are keen to know to know, this page by Ken Kuttler might help.\nIt‚Äôs probably still good for us to understand a little bit about the background as to how eigenvalues and eigenvectors work. This leads us to something called spectral theory: a branch of mathematics that studies the spectrum of a matrix or operator (including its eigenvalues and eigenvectors). Spectral theory helps us understand how a matrix behaves by analysing these components, offering deep insights into the structure and transformations represented by the matrix.\nWe can calculate these using the eigen() function in R, which will output both the values and the vectors.\nThe eigens:\n\neigen &lt;- eigen(cov_matrix_R)\n\nThis function will output both eigenvalues and eigenvectors. Alternatively, we can look at the value and vectors individually, for the purpose of calculating our principal components for this analysis lets do this, and go through what each eigen is showing.\n\nShow/Hide eigen Output\n\n\n\n\neigen() decomposition\n$values\n [1]  3.552576e+02  1.107888e+01  8.617986e+00  2.993896e+00  7.849813e-15\n [6]  1.289621e-15  5.405335e-16  3.633270e-17  9.287314e-32 -2.102773e-16\n[11] -1.365406e-15 -3.018445e-14\n$vectors\n             [,1]        [,2]        [,3]        [,4]         [,5]\n [1,]  0.78063519  0.09246510 -0.09110918  0.05643682  0.442049227\n [2,]  0.01435545 -0.31761481  0.51438923  0.48199530  0.328877551\n [3,] -0.36171417  0.28573974  0.01592520  0.19373557  0.001375333\n [4,] -0.36171417  0.28573974  0.01592520  0.19373557  0.344916440\n [5,] -0.20228279 -0.34790983  0.29478661  0.11591146  0.208929130\n [6,] -0.12071823 -0.15461907 -0.37585160  0.04924008  0.088644405\n [7,]  0.00000000  0.00000000  0.00000000  0.00000000  0.000000000\n [8,] -0.09592001  0.12432406  0.15624898 -0.41532392  0.143367861\n [9,] -0.21663824 -0.03029501 -0.21960262 -0.36608385  0.698426108\n[10,] -0.02479821 -0.27894314 -0.53210057  0.46456400 -0.011484218\n[11,]  0.04377806  0.68134994 -0.03738393  0.38576261  0.095757454\n[12,]  0.12071823  0.15461907  0.37585160 -0.04924008 -0.091097936\n               [,6]          [,7]          [,8]          [,9]         [,10]\n [1,]  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00\n [2,] -1.273819e-01 -6.464465e-02  3.998530e-02 -2.713994e-16 -4.784163e-02\n [3,] -4.998453e-01 -5.439577e-02  3.006026e-01 -1.442308e-15 -2.154630e-01\n [4,]  5.956601e-01  4.090559e-01 -1.610771e-01  1.175142e-15  1.341670e-01\n [5,]  3.156701e-02 -2.900155e-01 -1.795108e-01  5.385656e-16  1.291376e-01\n [6,]  1.908142e-01 -4.443074e-01 -4.299966e-01 -4.525482e-15 -5.815663e-01\n [7,] -9.803617e-16  5.217727e-17 -1.782932e-15  1.000000e+00 -6.518782e-15\n [8,] -3.687018e-01 -6.606470e-02 -6.204302e-01  1.370891e-15  3.789069e-01\n [9,] -2.039325e-01  1.040540e-01  2.662426e-01 -1.019423e-15 -1.727683e-01\n[10,] -3.628517e-01  4.076416e-01 -2.741809e-01  3.931050e-16  1.840657e-01\n[11,] -9.581485e-02 -3.546601e-01 -1.395255e-01  2.671662e-16  8.129596e-02\n[12,] -1.527733e-01  4.866930e-01 -3.383947e-01 -5.147566e-15 -6.037232e-01\n           [,11]       [,12]\n [1,]  0.0000000 -0.41852765\n [2,]  0.4511154  0.25698386\n [3,]  0.1227363 -0.58742834\n [4,]  0.1193344 -0.22457995\n [5,] -0.6931861 -0.28203086\n [6,]  0.2169611 -0.07723764\n [7,]  0.0000000  0.00000000\n [8,]  0.2845431 -0.09003593\n [9,] -0.1520000  0.32535310\n[10,] -0.1103916  0.05846761\n[11,] -0.2420706  0.39348064\n[12,] -0.2544753  0.07464622\n\n\n\n             \n\nThe eigenvalues:\n\neigen_values &lt;- eigen$values\n\nR has given us 12 eigenvalues because our dataset includes 12 different bacteria types, meaning the covariance matrix is 12√ó12. Each eigenvalue corresponds to a principal component and tells us how much variance in the data that component explains. As we can see, the first few eigenvalues are large, capturing most of the variation, while the later ones are extremely small - close to zero - and can be ignored. This means we can reduce the dimensionality of our data by focusing on just the components with the largest eigenvalues - we will go more into this later.\n\nShow/Hide eigen_values Output\n\n\n\n\n [1]  3.552576e+02  1.107888e+01  8.617986e+00  2.993896e+00  7.849813e-15\n [6]  1.289621e-15  5.405335e-16  3.633270e-17  9.287314e-32 -2.102773e-16\n[11] -1.365406e-15 -3.018445e-14\n\n\n\n\n\nThe eigenvectors:\n\neigen_vectors &lt;- eigen$vectors\n\nThe eigenvectors are set out the same sort of way as our co-variance matrix, in the order of Klebsiella, Acinetobacter, Pantonea etc... For example, the first eigenvalue shows 0.78063519 for Klebsiella v Klebsiella, the lack of negative value means it is in the opposite direction to Klebsiella and Pantonea, which has a negative value (-0.09110918).\n\nShow/Hide eigen_vectors output\n\n\n\n\n             [,1]        [,2]        [,3]        [,4]         [,5]\n [1,]  0.78063519  0.09246510 -0.09110918  0.05643682  0.442049227\n [2,]  0.01435545 -0.31761481  0.51438923  0.48199530  0.328877551\n [3,] -0.36171417  0.28573974  0.01592520  0.19373557  0.001375333\n [4,] -0.36171417  0.28573974  0.01592520  0.19373557  0.344916440\n [5,] -0.20228279 -0.34790983  0.29478661  0.11591146  0.208929130\n [6,] -0.12071823 -0.15461907 -0.37585160  0.04924008  0.088644405\n [7,]  0.00000000  0.00000000  0.00000000  0.00000000  0.000000000\n [8,] -0.09592001  0.12432406  0.15624898 -0.41532392  0.143367861\n [9,] -0.21663824 -0.03029501 -0.21960262 -0.36608385  0.698426108\n[10,] -0.02479821 -0.27894314 -0.53210057  0.46456400 -0.011484218\n[11,]  0.04377806  0.68134994 -0.03738393  0.38576261  0.095757454\n[12,]  0.12071823  0.15461907  0.37585160 -0.04924008 -0.091097936\n               [,6]          [,7]          [,8]          [,9]         [,10]\n [1,]  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00\n [2,] -1.273819e-01 -6.464465e-02  3.998530e-02 -2.713994e-16 -4.784163e-02\n [3,] -4.998453e-01 -5.439577e-02  3.006026e-01 -1.442308e-15 -2.154630e-01\n [4,]  5.956601e-01  4.090559e-01 -1.610771e-01  1.175142e-15  1.341670e-01\n [5,]  3.156701e-02 -2.900155e-01 -1.795108e-01  5.385656e-16  1.291376e-01\n [6,]  1.908142e-01 -4.443074e-01 -4.299966e-01 -4.525482e-15 -5.815663e-01\n [7,] -9.803617e-16  5.217727e-17 -1.782932e-15  1.000000e+00 -6.518782e-15\n [8,] -3.687018e-01 -6.606470e-02 -6.204302e-01  1.370891e-15  3.789069e-01\n [9,] -2.039325e-01  1.040540e-01  2.662426e-01 -1.019423e-15 -1.727683e-01\n[10,] -3.628517e-01  4.076416e-01 -2.741809e-01  3.931050e-16  1.840657e-01\n[11,] -9.581485e-02 -3.546601e-01 -1.395255e-01  2.671662e-16  8.129596e-02\n[12,] -1.527733e-01  4.866930e-01 -3.383947e-01 -5.147566e-15 -6.037232e-01\n           [,11]       [,12]\n [1,]  0.0000000 -0.41852765\n [2,]  0.4511154  0.25698386\n [3,]  0.1227363 -0.58742834\n [4,]  0.1193344 -0.22457995\n [5,] -0.6931861 -0.28203086\n [6,]  0.2169611 -0.07723764\n [7,]  0.0000000  0.00000000\n [8,]  0.2845431 -0.09003593\n [9,] -0.1520000  0.32535310\n[10,] -0.1103916  0.05846761\n[11,] -0.2420706  0.39348064\n[12,] -0.2544753  0.07464622\n\n\n\n\n¬†\n\n\nStep 5: Calculate the Principal Components\nNow we have found the eigenvalues and eigenvectors we work out the principal components! Let‚Äôs make sure to go through this step by step.\n5.1 We first need to take the centered data matrix we made earlier\ncentered_data_matrix\n5.2 We then need to work out the eigenvectors from the covariance matrix (we made the eigenvectors from our centered data):\n\neigen &lt;- eigen(cov_matrix_R)\neigen_vectors &lt;- eigen$vectors\n\n5.3 We choose what eigenvalues we are using\nOnly the first 4 principal components are actually positive values, principal components 5-12 are negative values, so we can in theory ignore these, and take the first four for now.\n\neigen_values &lt;- eigen$values[1:4]\neigen_values\n\n[1] 355.257570  11.078881   8.617986   2.993896\n\n\n¬† 5.4 We calculate the actual PC components\nWe know that the eigenvectors represent the direction of the principal components, so we first calculate our principal components, based on our centered data, and our eigenvectors, by using the matrix multiplication. We only take PC1 and PC2, as we only need the first 2.\n\nnew_data &lt;- centered_data_matrix %*% eigen_vectors\n\n\nFruit &lt;- c(\"Apricot\", \"Argan\", \"Grapefruit\", \"Orange\", \"Peach\", \"Tangerine\")\n\nPCA_values &lt;- data.frame(\n  Fruit = Fruit,\n  PC1 = new_data[, 1],\n  PC2 = new_data[, 2])\n\n \nPCA_values\n\n       Fruit        PC1       PC2\n1    Apricot  17.438399 -2.087273\n2      Argan  10.136971  3.714548\n3 Grapefruit  10.136971  3.714548\n4     Orange   5.075269 -3.482150\n5      Peach  -8.834367 -3.053711\n6  Tangerine -34.100923  1.414038\n\n\n¬†\n5.5 Generating the PCA plot.\nBut before we do this, earlier I mentioned that we will go back to the eigen values - this is for now. We took four as they were all positive values, but choosing components is usually based on what explains most of the variance, so we will be fine taking the first two. As they make up for the vast majority of the variance.\n\neigen_values &lt;- eigen_values[1:2]\n\nPCA_variance &lt;- round(100 * eigen_values / sum(eigen_values), 2)\n\nUsing these 2 PCA values, we can get away with generating just the one PCA plot; this is PCA 1 vs.¬†PCA 2.\n\nlibrary(ggplot2)\n\npca_plot &lt;- ggplot(PCA_values, aes(x = PC1, y = PC2, color = Fruit)) +\n  geom_point(size = 4) +\n  geom_text(aes(label = Fruit), vjust = -1, hjust = 1.2, size = 3, show.legend = FALSE) +\n  labs(\n    title = \"PCA of Fruit Samples\",\n    x = paste0(\"Principal Component 1 (\", PCA_variance[1], \"%)\"),\n    y = paste0(\"Principal Component 2 (\", PCA_variance[2], \"%)\")\n  ) +\n  theme_minimal() +\n  theme(\n    plot.margin = margin(20, 20, 20, 20),\n    plot.title = element_text(hjust = 0.5)\n  ) +\n  scale_color_brewer(palette = \"Dark2\")\n\npca_plot\n\n\n\n\n¬†\n¬† What can we see? ¬†\nThis PCA plot shows variation among different fruit samples based on their principal components. Samples like Orange and Peach cluster closely together, indicating similar microbiome compositions, while Apricot and Argan are positioned farther apart, meaning Medfly reared on these fruits may have greater differences. Grapefruit stands out as more distinct from the other samples. Overall, the plot shows clear groupings and separation among the Medfly microbiotas based on the fruits they were reared on. You can check this against the data shown at the beginning of this page!\n¬†\n¬†\nTo summarise this chapter, we have taken a deep dive into PCA, and hopefully what actually it is."
  }
]